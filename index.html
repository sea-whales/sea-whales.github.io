<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="树深时见鹿,溪午不闻钟~">
    

    <!--Author-->
    
        <meta name="author" content="Zephyr Lo">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Sea-Whales - 林深时见鹿，海蓝时见鲸"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="树深时见鹿,溪午不闻钟~" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Sea-Whales - 林深时见鹿，海蓝时见鲸"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>Sea-Whales - 林深时见鹿，海蓝时见鲸</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 7.3.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Sea-Whales - 林深时见鹿，海蓝时见鲸</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/192071107/">
                关键路径法简介
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-07-14</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="关键路径法简介"><a href="#关键路径法简介" class="headerlink" title="关键路径法简介"></a>关键路径法简介</h2><p>一个大型工程或项目包括很多活动，关键路径是项目中时间最长的活动顺序，决定着可能的项目最短工期。</p>
<p>关键路径法（Critical path method，CPM） 是一种基于进度网络模型的方法，用网络图表示各项活动之间的相互关系，获得在一定工期、成本、资源约束条件下的最优进度安排。</p>
<p>关键路径法源于美国杜邦公司对于项目管理控制成本、减少工期的研究。1959年，Kelly 和 Walker 在论文 Critical Path Planning and Scheduling 中提出了关键路径法的基本原理和方法：计算所有活动的工期，确定其最早开始 ES 和最早结束 EF、最晚开始 LS 和最晚结束 LF 的时间，按照活动的相互关系形成顺序的网络逻辑 图，找到必须的最长路径即为关键路径。</p>
<p>关键路径法将项目分解成为多个独立的活动并确定每个活动的工期，然后用逻辑关系（结束-开始、结束-结束、开始-开始和开始-结束）将活动连接。首先使用正推法（Forward pass），从起点开始向后计算，依次计算每个顶点（事件）的最早开始时间 ES；然后再使用逆推法（Backward pass），从终点开始向前计算，依次计算每个顶点（事件）的最迟结束时间 LF。进而可以求出每条边（工序）的最早结束时间 EF 和最迟开始时间 LS。最早开始时间 ES 和最晚开始时间 LS 相等的边，就是关键路径上的边，对应的工序是关键工序。</p>
<ul>
<li>ES：最早开始时间（Earliest Start），指某项活动能够开始的最早时间，取决于该项活动的所有紧前工作的结束时间，由顺推法计算 ES &#x3D; max{EF(preceding activities)}。</li>
<li>EF：最早结束时间（Earliest Finish），指某项活动能够完成的最早时间。EF &#x3D; ES+DU， DU为该活动的持续时间。</li>
<li>LF：最迟结束时间（Latest Finish），指为了保证整个项目按期完成的某项活动必须完成的最晚时间，取决于该项活动的所有紧后工作的最迟开始时间，由逆推法计算 LF &#x3D; min{LS(successor activities)}。</li>
<li>LS：最迟开始时间（Latest Start），指为了保证整个项目按期完成的某项活动必须开始的最迟时间。LS &#x3D; LF -DU，DU为该活动的持续时间。</li>
<li>TF：总时差（Total float time），指在不影响总工期的条件下，一个活动可以利用的机动时间。TF &#x3D; LF - EF。</li>
<li>FF：自由时差（Free float time），指在不影响紧后工作最早开始时间的条件下，一个活动可能被延迟的时间。FF &#x3D; min{ES(successor activities)} - EF。<br>由关键路径法得到的最早&#x2F;最晚的开始&#x2F;结束时间并不一定就是项目进度计划，而是把既定的参数（活动持续时间、逻辑关系、提前量、滞后量和其它制约条件）输入进度模型后所得到的结果，表明活动可以在该时段内实施。</li>
</ul>
<p>早期关键路径法的表示方法都是箭线法（ADM），随着计算机的发展，前导图（PDM）逐渐成为主流方法。</p>
<h2 id="关键路径法"><a href="#关键路径法" class="headerlink" title="关键路径法"></a>关键路径法</h2><p>某项目工程由 11项作业组成（分别用 A、B、…K表示），其计划完成时间及作业间相互关系如下表所示。建立计划网络图，并计算完成该项目的最短时间。</p>
<table>
<thead>
<tr>
<th>作业</th>
<th>计划完成天数</th>
<th>紧前工序</th>
<th>作业</th>
<th>计划完成天数</th>
<th>紧前工序</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>5</td>
<td>无</td>
<td>G</td>
<td>21</td>
<td>B,E</td>
</tr>
<tr>
<td>B</td>
<td>10</td>
<td>无</td>
<td>H</td>
<td>35</td>
<td>B,E</td>
</tr>
<tr>
<td>C</td>
<td>11</td>
<td>无</td>
<td>I</td>
<td>25</td>
<td>B,E</td>
</tr>
<tr>
<td>D</td>
<td>4</td>
<td>B</td>
<td>J</td>
<td>15</td>
<td>F,G,I</td>
</tr>
<tr>
<td>E</td>
<td>4</td>
<td>A</td>
<td>K</td>
<td>20</td>
<td>F,G</td>
</tr>
<tr>
<td>F</td>
<td>15</td>
<td>C,D</td>
<td>.</td>
<td>.</td>
<td>.</td>
</tr>
<tr>
<td>本案例问题来自：司守奎、孙兆亮，数学建模算法与应用（第2版），P62-68，例4.16-4.18，国防工业出版社。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>问题分析： 用如下图所示的计划网络图表示问题描述的各项作业及作业间的相互关系。图中的顶点表示作业开始或结束的事件，顶点之间的边（箭线）表示一项作业，边的权值表示该项作业的完成时间。虚线边表示虚拟作业。 该计划网络图的关键路径长度，即为完成该项目的最短时间。</p>
<img src="http://cdn.sea-whales.cn/images/118754623.png">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mathmodel23_v1.py</span></span><br><span class="line"><span class="comment"># Demo23 of mathematical modeling algorithm</span></span><br><span class="line"><span class="comment"># Demo of critical path method (CPM)  with NetworkX</span></span><br><span class="line"><span class="comment"># Copyright 2021 YouCans, XUPT</span></span><br><span class="line"><span class="comment"># Crated：2021-07-25</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt  <span class="comment"># 导入 Matplotlib 工具包</span></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx  <span class="comment"># 导入 NetworkX 工具包</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 拓扑序列(topological sequence) 和 关键路径(critical path)</span></span><br><span class="line"><span class="comment"># Activity on edge network(AOE), 顶点表示事件或状态，有向边表示活动</span></span><br><span class="line">DG = nx.DiGraph()  <span class="comment"># 创建：空的 有向图</span></span><br><span class="line">DG.add_weighted_edges_from([(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>), (<span class="number">1</span>, <span class="number">3</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>),</span><br><span class="line">                            (<span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>),</span><br><span class="line">                            (<span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">5</span>, <span class="number">0</span>),</span><br><span class="line">                            (<span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>),</span><br><span class="line">                            (<span class="number">5</span>, <span class="number">6</span>, <span class="number">21</span>), (<span class="number">5</span>, <span class="number">7</span>, <span class="number">25</span>), (<span class="number">5</span>, <span class="number">8</span>, <span class="number">35</span>),</span><br><span class="line">                            (<span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>), (<span class="number">6</span>, <span class="number">8</span>, <span class="number">20</span>),</span><br><span class="line">                            (<span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>)])  <span class="comment"># 向图中添加多条赋权边: (n1,n2,weight)</span></span><br><span class="line">lenNodes = <span class="built_in">len</span>(DG.nodes)  <span class="comment"># 顶点数量</span></span><br><span class="line">topoSeq = <span class="built_in">list</span>(nx.topological_sort(DG))  <span class="comment"># 拓扑序列</span></span><br><span class="line">nodeCP = <span class="built_in">list</span>(nx.dag_longest_path(DG))  <span class="comment"># 关键路径（节点）</span></span><br><span class="line">lenCP = nx.dag_longest_path_length(DG)  <span class="comment"># 关键路径的长度</span></span><br><span class="line">edgesCP=[]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(nodeCP)):</span><br><span class="line">    edgesCP.append((nodeCP[k-<span class="number">1</span>],nodeCP[k]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;拓扑序列：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(topoSeq))  <span class="comment"># [1, 3, 4, 2, 5, 6, 7, 8]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;关键路径的顶点：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(nodeCP))  <span class="comment"># [1, 3, 5, 6, 8]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;关键路径的边：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(edgesCP))  <span class="comment"># [(1, 3), (3, 5), (5, 6), (6, 8)]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;关键路径长度：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(lenCP))  <span class="comment"># 51</span></span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">pos = &#123;<span class="number">1</span>:(<span class="number">0</span>,<span class="number">4</span>), <span class="number">2</span>:(<span class="number">5</span>,<span class="number">7</span>), <span class="number">3</span>:(<span class="number">5</span>,<span class="number">4</span>), <span class="number">4</span>:(<span class="number">5</span>,<span class="number">1</span>), <span class="number">5</span>:(<span class="number">10</span>,<span class="number">7</span>), <span class="number">6</span>:(<span class="number">10</span>,<span class="number">1</span>), <span class="number">7</span>:(<span class="number">15</span>,<span class="number">4</span>), <span class="number">8</span>:(<span class="number">20</span>,<span class="number">4</span>)&#125;  <span class="comment"># 指定顶点位置</span></span><br><span class="line">edgesDG = DG.edges</span><br><span class="line">edgesDashed = [(<span class="number">3</span>,<span class="number">5</span>),(<span class="number">6</span>,<span class="number">7</span>)]</span><br><span class="line">edgesSolid = <span class="built_in">list</span>(<span class="built_in">set</span>(edgesDG)-<span class="built_in">set</span>(edgesDashed))</span><br><span class="line">labels = nx.get_edge_attributes(DG, <span class="string">&#x27;weight&#x27;</span>)</span><br><span class="line"><span class="comment"># nx.draw(DG, pos, with_labels=True, node_color=&#x27;skyblue&#x27;)  # 绘制有向图</span></span><br><span class="line">nx.draw_networkx_nodes(DG, pos, node_color=<span class="string">&#x27;orange&#x27;</span>,node_size=<span class="number">400</span>)  <span class="comment"># 设置指定顶点的颜色、宽度</span></span><br><span class="line">nx.draw_networkx_labels(DG, pos)  <span class="comment"># 设置指定顶点的标签</span></span><br><span class="line">nx.draw_networkx_edges(DG, pos, edgelist=edgesSolid, edge_color=<span class="string">&#x27;dimgrey&#x27;</span>, style=<span class="string">&#x27;solid&#x27;</span>)  <span class="comment"># 设置指定边的颜色、线型</span></span><br><span class="line">nx.draw_networkx_edges(DG, pos, edgelist=edgesDashed, edge_color=<span class="string">&#x27;grey&#x27;</span>, style=<span class="string">&#x27;dashed&#x27;</span>)  <span class="comment"># 设置指定边，虚线</span></span><br><span class="line">nx.draw_networkx_edge_labels(DG, pos, edge_labels=labels, font_color=<span class="string">&#x27;dimgrey&#x27;</span>)  <span class="comment"># 显示边的权值</span></span><br><span class="line">ax.set_title(<span class="string">&quot;Project network graph by youcans@xupt&quot;</span>)</span><br><span class="line">ax.text(<span class="number">16</span>, <span class="number">0</span>, <span class="string">&quot;youcans-xupt&quot;</span>, color=<span class="string">&#x27;gainsboro&#x27;</span>)</span><br><span class="line">plt.xlim(-<span class="number">2</span>, <span class="number">22</span>)</span><br><span class="line">plt.ylim(-<span class="number">1</span>, <span class="number">9</span>)</span><br><span class="line">plt.axis(<span class="string">&#x27;on&#x27;</span>)</span><br><span class="line">plt.show()  <span class="comment"># YouCans, XUPT</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>程序运行结果：</p>
<pre><code>拓扑序列：[1, 3, 4, 2, 5, 6, 7, 8]
关键路径的顶点：[1, 3, 5, 6, 8]
关键路径的边：[(1, 3), (3, 5), (5, 6), (6, 8)]
关键路径长度：51
</code></pre>
<blockquote>
<p>原文链接：(<a target="_blank" rel="noopener" href="https://blog.csdn.net/youcans/article/details/118754623">https://blog.csdn.net/youcans/article/details/118754623</a>)</p>
</blockquote>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/3061785244/">
                Kivy笔记
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-07-14</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="Kivy命名规则"><a href="#Kivy命名规则" class="headerlink" title="Kivy命名规则"></a>Kivy命名规则</h2><p>1、类继承App的类名(小写)（除去App）+ .kv<br>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.gridlayout <span class="keyword">import</span> GridLayout</span><br><span class="line"><span class="keyword">from</span> kivy.uix.label <span class="keyword">import</span> Label</span><br><span class="line"><span class="keyword">from</span> kivy.uix.textinput <span class="keyword">import</span> TextInput</span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Color,Rectangle</span><br><span class="line"><span class="keyword">from</span> kivy.properties <span class="keyword">import</span> ColorProperty, ListProperty</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginScreen</span>(<span class="title class_ inherited__">GridLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(LoginScreen, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line">        <span class="variable language_">self</span>.cols = <span class="number">2</span></span><br><span class="line">        <span class="variable language_">self</span>.rows = <span class="number">6</span></span><br><span class="line">        <span class="variable language_">self</span>.add_widget(Label(text=<span class="string">&#x27;User Name&#x27;</span>))</span><br><span class="line">        <span class="variable language_">self</span>.username = TextInput(multiline=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(<span class="variable language_">self</span>.username)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(Label(text=<span class="string">&#x27;password&#x27;</span>))</span><br><span class="line">        <span class="variable language_">self</span>.password = TextInput(password=<span class="literal">True</span>, multiline=<span class="literal">False</span>)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(<span class="variable language_">self</span>.password)</span><br><span class="line">        <span class="variable language_">self</span>.button = Button(size=(<span class="number">.4</span>, <span class="number">.63</span>), text=<span class="string">&#x27;iPaoMi&#x27;</span>, background_color=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), font_size=<span class="number">15</span>, color=(<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">        <span class="variable language_">self</span>.button.bind(on_press=<span class="variable language_">self</span>.on_push)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_widget(<span class="variable language_">self</span>.button)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.password.canvas.before:</span><br><span class="line">            Color(<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.5</span>)</span><br><span class="line">            <span class="variable language_">self</span>.password = Rectangle(size=<span class="variable language_">self</span>.password.size, pos=<span class="variable language_">self</span>.password.pos)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_push</span>(<span class="params">self, inst</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;inst&#x27;</span>+inst.text)</span><br><span class="line">        <span class="variable language_">self</span>.button.text = inst.text</span><br><span class="line">        <span class="variable language_">self</span>.button.height=<span class="number">12</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.root = root = LoginScreen()</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    MyApp().run()</span><br></pre></td></tr></table></figure>

<p>创建的kv文件则为 <code>my.kv</code><br>代码分离规则：<br>定义页面:<br>使用<code>&lt;&gt;:</code>创建一个页面，页面和py里的类一致。<br>例如：<br>且使用缩进标识控件和属性的隶属关系。</p>
<pre><code>&lt;LoginScreen&gt;:
    BoxLayout:
        Button:
    BoxLayout:
        Button:
&lt;LoginScreen&gt;:
</code></pre>
<p>使用kv文件则无须使用Py文件进行编写布局，可直接如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginScreen</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>其实kv文件读取我们也可以直接将文件内容以字符串形式写在任意变量内，任何使用,如下</p>
<pre><code>from kivy.lang import Builder
Builder.load_string(&quot;&quot;&quot;
    &lt;LoginScreen&gt;:
        BoxLayout:
            Button:
        BoxLayout:
            Button:
    &lt;LoginScreen&gt;:
&quot;&quot;&quot;)
class LoginScreen(BoxLayout):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)

class MyApp(App):
    def build(self):
        return LoginScreen()   # Kivy会自动缩放根控件，

if __name__ == &quot;__main__&quot;:
    MyApp().run()
</code></pre>
<h2 id="Kivy-中文显示"><a href="#Kivy-中文显示" class="headerlink" title="Kivy 中文显示"></a>Kivy 中文显示</h2><h2 id="Kivy-属性"><a href="#Kivy-属性" class="headerlink" title="Kivy 属性"></a>Kivy 属性</h2><h3 id="位置和尺寸（大小）"><a href="#位置和尺寸（大小）" class="headerlink" title="位置和尺寸（大小）"></a>位置和尺寸（大小）</h3><h4 id="尺寸-（大小）"><a href="#尺寸-（大小）" class="headerlink" title="尺寸 （大小）"></a>尺寸 （大小）</h4><p>大小有两种写法一种是 <code>size </code>另一种是 <code>size_hint</code></p>
<h5 id="size"><a href="#size" class="headerlink" title="size"></a>size</h5><p>传入的值是一个固定的宽高值</p>
<h5 id="size-hint"><a href="#size-hint" class="headerlink" title="size_hint"></a>size_hint</h5><p>传入的是按照当前窗口比例的宽高值，一般写做如下：</p>
<pre><code>size_hint: .4, .5
或者
size_hint: 0.4, 0.5
</code></pre>
<h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><p>位置也有和大小一样的两种属性，一种<code>pos</code>另一个是<code>pos_hint</code></p>
<h5 id="pos"><a href="#pos" class="headerlink" title="pos"></a>pos</h5><pre><code>pos: 
</code></pre>
<h5 id="pos-hint"><a href="#pos-hint" class="headerlink" title="pos_hint"></a>pos_hint</h5><p>按照宽高比例的写法是允许省略0的写法。<br>比例值的计算是以左下角为坐标系起点<code>（0，0）</code>，横向为x轴，纵向为y，假设宽为W，高为L，则窗内任意一点的比例值为<code>[W/x,L/y]</code><br>相对于控件， x轴上有三条边可以确定位置:</p>
<ul>
<li><pre><code>   左边界x
</code></pre>
</li>
<li><pre><code>   正中间线center_x
</code></pre>
</li>
<li><pre><code>   右边界right
</code></pre>
</li>
</ul>
<p>同样，y轴也有三条可以确定位置：</p>
<ul>
<li><pre><code>   上边界top
</code></pre>
</li>
<li><pre><code>   正中间线center_y
</code></pre>
</li>
<li><pre><code>   下边界y
</code></pre>
</li>
</ul>
<p>X轴和Y轴各有三种他们两两组合共有9种写法可以确定一个位置。</p>
<pre><code>pos_hint: &#123;&#39;x&#39;: .8, &#39;y&#39;: .4&#125;
或
pos_hint： &#123;&#39;right&#39;: .7, &#39;top&#39;: .3&#125;
或者
pos_hint： &#123;&#39;center_y&#39;: .7, &#39;center_x&#39;: .3&#125;
</code></pre>
<p>以上x、y、right、top、center_y、center_x都是以控件为主，距离布局窗体的X轴和Y轴。</p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><h3 id="FloatLayout"><a href="#FloatLayout" class="headerlink" title="FloatLayout"></a>FloatLayout</h3><p>py文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.floatlayout <span class="keyword">import</span> FloatLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FloatLayoutWidget</span>(<span class="title class_ inherited__">FloatLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(FloatLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FloatLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> FloatLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    FloatLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>kv文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义按钮</span></span><br><span class="line">&lt;Button&gt;</span><br><span class="line">    font_size: <span class="number">40</span>       <span class="comment"># 字体大小</span></span><br><span class="line">    size_hint: <span class="number">.3</span>, <span class="number">.4</span>   <span class="comment"># 按钮大小</span></span><br><span class="line"></span><br><span class="line">&lt;FloatLayoutWidget&gt;     <span class="comment"># 定义页面</span></span><br><span class="line">    canvas:             <span class="comment"># 设置背景颜色</span></span><br><span class="line">        Color:</span><br><span class="line">            rgba: [<span class="number">.2</span>, <span class="number">.4</span>, <span class="number">.5</span>, <span class="number">.6</span>]</span><br><span class="line"></span><br><span class="line">        Rectangle:</span><br><span class="line">            size: <span class="variable language_">self</span>.size</span><br><span class="line">            pos: <span class="variable language_">self</span>.pos</span><br><span class="line"></span><br><span class="line">    Button:             <span class="comment"># 使用自定义按钮</span></span><br><span class="line">        text: <span class="string">&quot;BT1&quot;</span>     <span class="comment"># 按钮显示文本</span></span><br><span class="line">        background_color: <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span> <span class="comment"># 按钮背景颜色</span></span><br><span class="line">        pos_hint: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;top&#x27;</span>: <span class="number">1</span>&#125; <span class="comment"># 按钮位置</span></span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: <span class="string">&quot;BT2&quot;</span></span><br><span class="line">        background_color: <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">.4</span>, <span class="number">.5</span></span><br><span class="line">        pos_hint: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">.35</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">.3</span>&#125;</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: <span class="string">&quot;BT3&quot;</span></span><br><span class="line">        background_color: <span class="number">.5</span>, <span class="number">.4</span>, <span class="number">.3</span>, <span class="number">.2</span></span><br><span class="line">        pos_hint: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">.7</span>, <span class="string">&#x27;bottom&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: <span class="string">&quot;BT4&quot;</span></span><br><span class="line">        background_color: <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        pos_hint: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">0.7</span>, <span class="string">&#x27;top&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: <span class="string">&quot;BT5&quot;</span></span><br><span class="line">        background_color: <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        pos_hint: &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;bottom&#x27;</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BoxLayout"><a href="#BoxLayout" class="headerlink" title="BoxLayout"></a>BoxLayout</h3><p>盒子布局，可以将部件水平或者垂直排列的布局。类似于安卓的线性布局。如果没有限制任何大小，部件将会以10px间距平分父窗口大小。</p>
<p>只用Python进行布局的话如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Rectangle, Color</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置背景颜色</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            Color(<span class="number">.4</span>, <span class="number">.5</span>, <span class="number">.02</span>, <span class="number">.3</span>)</span><br><span class="line">            <span class="variable language_">self</span>.rect = Rectangle(pos=<span class="variable language_">self</span>.pos, size=<span class="variable language_">self</span>.size)</span><br><span class="line">            <span class="variable language_">self</span>.bind(pos=<span class="variable language_">self</span>.update_rect, size=<span class="variable language_">self</span>.update_rect)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 新建一个指定尺寸的按钮</span></span><br><span class="line">        button1 = Button(text=<span class="string">&#x27;Hello BoxLayout1&#x27;</span>, size_hint=(<span class="number">.3</span>, <span class="number">.2</span>), pos=(<span class="number">200</span>, <span class="number">40</span>), background_color=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">        button2 = Button(text=<span class="string">&#x27;Hello BoxLayout2&#x27;</span>, size_hint=(<span class="number">.2</span>, <span class="number">.2</span>), pos=(<span class="number">200</span>, <span class="number">40</span>), background_color=(<span class="number">.6</span>, <span class="number">.5</span>, <span class="number">.8</span>, <span class="number">.3</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将按钮加到布局内</span></span><br><span class="line">        <span class="variable language_">self</span>.add_widget(button1)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(button2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_rect</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rect.pos = <span class="variable language_">self</span>.pos</span><br><span class="line">        <span class="variable language_">self</span>.rect.size = <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    BoxLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>或者配合kv文件进行布局：</p>
<p>python代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutTApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    BoxLayoutTApp().run()</span><br></pre></td></tr></table></figure>

<p>kv文件如下：（kv文件创建遵守kv命名规则）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button&gt;</span><br><span class="line">    font_size: 50</span><br><span class="line"></span><br><span class="line">&lt;BoxLayoutWidget&gt;</span><br><span class="line">    </span><br><span class="line">    canvas:</span><br><span class="line">        Color:</span><br><span class="line">            rgba: [.2, .4, .5, .6]</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT1&quot;</span><br><span class="line">        background_color: 1, 0, 0, 1</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT2&quot;</span><br><span class="line">        background_color: 1, 1, 1, 1</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT3&quot;</span><br><span class="line">        background_color: 0, 1, 0, 1</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT4&quot;</span><br><span class="line">        background_color: 1, 0, 1, 1</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT5&quot;</span><br><span class="line">        background_color: 0, 1, 1, 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>默认<code>BoxLayout</code>排版是纵向排版，若需要改为横向排版则可在KV文件里添加参数<code>orientation: &quot;vertical&quot;</code> 若是使用python实现则可以将实例化<code>BoxLayout</code>时，添加参数<code>BoxLayout(orientation=&quot;vertical&quot;)</code></p>
<h4 id="BoxLayout间距"><a href="#BoxLayout间距" class="headerlink" title="BoxLayout间距"></a>BoxLayout间距</h4><p>BoxLayout布局中间距有两种形式：</p>
<ul>
<li>布局和子级之间填充是需要使用<code>padding</code>，默认为<code>[0, 0, 0, 0]</code> ,四个参数分别为 <code>[padding_left, padding_top, padding_right, padding_bottom]</code> 从右下脚开始顺时针一一对应。（左，上，右，下）；同时padding还接受两个参数形式<code>[padding_horizontal, padding_vertical]</code> 分别是水平边距和竖直边距；或者一个参数形式<code>[padding]</code>代表周围边距。</li>
<li>子级和子级之间填充需要使用<code>spacing</code>, 默认为 0</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button&gt;</span><br><span class="line">    font_size: 10</span><br><span class="line"></span><br><span class="line">&lt;BoxLayoutWidget&gt;</span><br><span class="line">    orientation: &quot;vertical&quot;    # 横向排版</span><br><span class="line">    padding: [10, 20, 30, 40]  # 设置间距</span><br><span class="line">    canvas:</span><br><span class="line">        Color:</span><br><span class="line">            rgba: [.2, .4, .5, .6]</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT1&quot;  # 显示文本，.KV默认是不支持中文</span><br><span class="line">        background_color: 1, 0, 0, 1</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &quot;BT2&quot;</span><br><span class="line">        background_color: 1, 1, 1, 1</span><br><span class="line">    BoxLayout:</span><br><span class="line">        orientation: &quot;vertical&quot; # 设置间距</span><br><span class="line">        spacing: 20</span><br><span class="line">        Button:</span><br><span class="line">            text: &quot;BT3&quot;</span><br><span class="line">            background_color: 0, 1, 0, 1</span><br><span class="line">    </span><br><span class="line">        Button:</span><br><span class="line">            text: &quot;BT4&quot;</span><br><span class="line">            background_color: 1, 0, 1, 1</span><br><span class="line">    </span><br><span class="line">        Button:</span><br><span class="line">            text: &quot;BT5&quot;</span><br><span class="line">            size_hint_y: .15  # 设置按钮大小</span><br><span class="line">            background_color: 0, 1, 1, 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="AnchorLayout布局（锚点布局）"><a href="#AnchorLayout布局（锚点布局）" class="headerlink" title="AnchorLayout布局（锚点布局）"></a>AnchorLayout布局（锚点布局）</h3><p>锚点布局可以将子部件放在 左上、中上、右上、左中、正中、右中、左下、中下、右下 ，9个位置处。只需要指定<code>anchor_x</code>和<code>anchor_y</code>属性即可。</p>
<ul>
<li><code>anchor_x</code> 默认值为<code>center</code>,可以且只可以接受<code>left</code>、<code>right</code>、<code>center</code>,分别为左、右和中。</li>
<li><ul>
<li><code>anchor_y</code> 默认值为<code>center</code>,可以且只可以接受<code>top</code>、<code>bottom</code>、<code>center</code>,分别为上、下和中。</li>
</ul>
</li>
</ul>
<p>python代码实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.anchorlayout <span class="keyword">import</span> AnchorLayout</span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Rectangle, Color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnchorLayoutWidget</span>(<span class="title class_ inherited__">AnchorLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(AnchorLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置颜色</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            Color(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="variable language_">self</span>.rect = Rectangle(pos=<span class="variable language_">self</span>.pos, size=<span class="variable language_">self</span>.size)</span><br><span class="line">            <span class="variable language_">self</span>.bind(pos=<span class="variable language_">self</span>.update_rect, size=<span class="variable language_">self</span>.update_rect)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第一个布局</span></span><br><span class="line">        anchor_first = AnchorLayout(anchor_x=<span class="string">&#x27;left&#x27;</span>, anchor_y=<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">        anchor_first.add_widget(Button(text=<span class="string">&#x27;left-top&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第二个布局</span></span><br><span class="line">        anchor_second = AnchorLayout(anchor_x=<span class="string">&#x27;center&#x27;</span>, anchor_y=<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">        anchor_second.add_widget(Button(text=<span class="string">&#x27;center-top&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第三个布局</span></span><br><span class="line">        anchor_third = AnchorLayout(anchor_x=<span class="string">&#x27;right&#x27;</span>, anchor_y=<span class="string">&#x27;top&#x27;</span>)</span><br><span class="line">        anchor_third.add_widget(Button(text=<span class="string">&#x27;right-top&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第四个布局</span></span><br><span class="line">        anchor_fourth = AnchorLayout(anchor_x=<span class="string">&#x27;left&#x27;</span>, anchor_y=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">        anchor_fourth.add_widget(Button(text=<span class="string">&#x27;left-center&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第五个布局</span></span><br><span class="line">        anchor_fifth = AnchorLayout(anchor_x=<span class="string">&#x27;center&#x27;</span>, anchor_y=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">        anchor_fifth.add_widget(Button(text=<span class="string">&#x27;center-center&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第六个布局</span></span><br><span class="line">        anchor_sixth = AnchorLayout(anchor_x=<span class="string">&#x27;right&#x27;</span>, anchor_y=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">        anchor_sixth.add_widget(Button(text=<span class="string">&#x27;right-center&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第七个布局</span></span><br><span class="line">        anchor_seventh = AnchorLayout(anchor_x=<span class="string">&#x27;left&#x27;</span>, anchor_y=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">        anchor_seventh.add_widget(Button(text=<span class="string">&#x27;left-bottom&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">.5</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第八个布局</span></span><br><span class="line">        anchor_eighth = AnchorLayout(anchor_x=<span class="string">&#x27;center&#x27;</span>, anchor_y=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">        anchor_eighth.add_widget(Button(text=<span class="string">&#x27;center-bottom&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">1</span>, <span class="number">.5</span>, <span class="number">1</span>, <span class="number">.5</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 嵌套第九个布局</span></span><br><span class="line">        anchor_ninth = AnchorLayout(anchor_x=<span class="string">&#x27;right&#x27;</span>, anchor_y=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">        anchor_ninth.add_widget(Button(text=<span class="string">&#x27;right-bottom&#x27;</span>, size_hint=[<span class="number">.3</span>, <span class="number">.3</span>], background_color=[<span class="number">.5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">.5</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_first)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_second)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_third)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_fourth)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_fifth)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_sixth)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_seventh)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_eighth)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(anchor_ninth)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_rect</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rect.pos = <span class="variable language_">self</span>.pos</span><br><span class="line">        <span class="variable language_">self</span>.rect.size = <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnchorLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> AnchorLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    AnchorLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>或者配合kv文件进行布局：<br>python代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutTApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    BoxLayoutTApp().run()</span><br></pre></td></tr></table></figure>

<p>kv文件如下：</p>
<pre><code>&lt;Button&gt;
    font_size: 10
    size_hint: .3, .3

&lt;AnchorLayoutWidget&gt;
    padding: 20

    AnchorLayout:
        anchor_x: &#39;left&#39;
        anchor_y: &#39;top&#39;
        Button:
            background_color: 0, 0, 0, 1
            text: &#39;left-top&#39;

    AnchorLayout:
        anchor_x: &#39;center&#39;
        anchor_y: &#39;top&#39;
        Button:
            text: &#39;center-top&#39;
            background_color: 0, 0, 1, 1

    AnchorLayout:
        anchor_x: &#39;right&#39;
        anchor_y: &#39;top&#39;
        Button:
            text: &#39;right-top&#39;
            background_color: 0, 1, 1, 1

    AnchorLayout:
        anchor_x: &#39;center&#39;
        anchor_y: &#39;center&#39;
        Button:
            text: &#39;center-center&#39;
            background_color: 1, 1, 0, 1

    AnchorLayout:
        anchor_x: &#39;left&#39;
        anchor_y: &#39;center&#39;
        Button:
            text: &#39;left-center&#39;
            background_color: 0, 1, 0, 1

    AnchorLayout:
        anchor_x: &#39;right&#39;
        anchor_y: &#39;center&#39;
        Button:
            text: &#39;right-center&#39;
            background_color: 1, 0, 1, 1

    AnchorLayout:
        anchor_x: &#39;left&#39;
        anchor_y: &#39;bottom&#39;
        Button:
            text: &#39;left-bottom&#39;
            background_color: 0, 1, .5, 1

    AnchorLayout:
        anchor_x: &#39;center&#39;
        anchor_y: &#39;bottom&#39;
        Button:
            text: &#39;center-bottom&#39;
            background_color: 1, .5, 1, .5

    AnchorLayout:
        anchor_x: &#39;right&#39;
        anchor_y: &#39;bottom&#39;
        Button:
            text: &#39;right-bottom&#39;
            background_color: .5, 1, 1, .5
</code></pre>
<h3 id="GridLayout-网格布局"><a href="#GridLayout-网格布局" class="headerlink" title="GridLayout (网格布局)"></a>GridLayout (网格布局)</h3><p>可以将子部件排列成多行多列的矩阵，根据布局配置按照子部件的索引为每一个子部件分配位置。新建网格布局的时候，需要设置具体的行（<code>cols</code>）和列（<code>rows</code>）数，作为约束。否则设置是无效的。<br>设置具体的行列后，当子部件变化时，布局就会根据改值进行扩展，但是总数不会超过设置的上限值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.gridlayout <span class="keyword">import</span> GridLayout</span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Rectangle, Color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GridLayoutWidget</span>(<span class="title class_ inherited__">GridLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(GridLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            Color(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="variable language_">self</span>.rect = Rectangle(pos=<span class="variable language_">self</span>.pos, size=<span class="variable language_">self</span>.size)</span><br><span class="line">            <span class="variable language_">self</span>.bind(pos=<span class="variable language_">self</span>.update_rect, size=<span class="variable language_">self</span>.update_rect)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.cols = <span class="number">3</span></span><br><span class="line">        <span class="variable language_">self</span>.rows = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            btn = Button(text=<span class="string">f&#x27;BTN_<span class="subst">&#123;i&#125;</span>&#x27;</span>, background_color=(<span class="number">0.2</span>, <span class="number">.2</span>, <span class="number">.4</span>))</span><br><span class="line">            <span class="variable language_">self</span>.add_widget(btn)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_rect</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rect.pos = <span class="variable language_">self</span>.pos</span><br><span class="line">        <span class="variable language_">self</span>.rect.size = <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GridLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> GridLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    GridLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>配合kv文件代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.gridlayout <span class="keyword">import</span> GridLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GridLayoutWidget</span>(<span class="title class_ inherited__">GridLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(GridLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GridLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> GridLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    GridLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>kv代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button&gt;</span><br><span class="line">    font_size: 10</span><br><span class="line">    size_hint: .3, .4</span><br><span class="line"></span><br><span class="line">&lt;GridLayoutWidget&gt;</span><br><span class="line">    rows:3</span><br><span class="line">    cols:3</span><br><span class="line">    padding: 15</span><br><span class="line">    spacing: 20</span><br><span class="line">    Button:</span><br><span class="line">        background_color: 0, 1, 0, 1</span><br><span class="line">        text: &#x27;btn_1&#x27;</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        background_color: .1, 0, 1, 1</span><br><span class="line">        text: &#x27;btn_2&#x27;</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        background_color: 0, .5, .4, 1</span><br><span class="line">        text: &#x27;btn_3&#x27;</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        background_color: 0, 1, 0, .5</span><br><span class="line">        text: &#x27;btn_4&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="GridLayout设置布局大小"><a href="#GridLayout设置布局大小" class="headerlink" title="GridLayout设置布局大小"></a>GridLayout设置布局大小</h4><p>GridLayout布局种，可以使用部件本身属性为其指定大小，若要对部件设置固定宽度，在设置之前则需要将<code>size_hint_x</code>设置为<code>None</code>。</p>
<h4 id="GridLayout为部件指定大小"><a href="#GridLayout为部件指定大小" class="headerlink" title="GridLayout为部件指定大小"></a>GridLayout为部件指定大小</h4><p>需要使用<code>col_force_default</code>属性，其默认值<code>False</code>,表示不使用列默认宽度。需要将<code>col_force_default</code>设置为<code>True</code>。并且在没有给子部件设置<code>width</code>和<code>size_hint_x</code>的属性的情况下,使用默认的列宽。列宽的默认值为<code>0</code>。所以还需要指定一个具体的值，使用<code>col_default_width</code>可以设置成功。同上，对与设置行高也可以相同的方法将<code>row_force_default</code>设置<code>True</code>,并且<code>row_default_height</code>设置值。</p>
<h4 id="设置列宽行高"><a href="#设置列宽行高" class="headerlink" title="设置列宽行高"></a>设置列宽行高</h4><h5 id="布局的宽高"><a href="#布局的宽高" class="headerlink" title="布局的宽高"></a>布局的宽高</h5><p>可以使用<code>cols_minimum</code>设置属性的列宽，<code>cols_minimum</code>属性接受的值是一个字典，字典的键为列号，值为像素值。例如:<code>cols_minimum:&#123;0: 130, 1:140&#125;</code><br>将第一列设置为130像素，第二列设置为140像素。<br>执行一下代码后，可以发现，从执行顺序的优先级来说，可以按照如下顺序： <code>col_default_width &lt; cols_minimum &lt; width</code>。<br>同理，也可以通过<code>rows_minimum</code>设置属性的行高<code>rows_minimum: &#123;0: 50&#125;</code>。<br>可参考如下kv代码：</p>
<pre><code>&lt;Button&gt;
    font_size: 50
    size_hint: .3, .4


&lt;GridLayoutWidget&gt;

    rows:3  # 设置行数
    cols:3  # 设置列数
    padding: 15 # 设置间距
    spacing: 20 # 设置间距
    col_force_default: True # 强制使用默认列宽
    col_default_width: 200 # 设置默认，列宽
    row_force_default: True # 强制使用默认行高
    row_default_height: &#39;34px&#39; # 设置默认行高
    
    cols_minimum:&#123;0: 130, 1:140&#125;  # 设置列宽
    rows_minimum: &#123;0: 50&#125; # 设置行高
    canvas:
        Color:
            rgba: .3,.3,.5,.5
        Rectangle:
            size: self.size
            pos: self.pos
    Button:
        background_color: 0, 1, 0, 1
        text: &#39;btn_1&#39;
        size_hint_x: None
        width: &#39;300px&#39;

    Button:
        background_color: .1, 0, 1, 1
        text: &#39;btn_2&#39;

    Button:
        background_color: 0, .5, .4, 1
        text: &#39;btn_3&#39;

    Button:
        background_color: 0, 1, 0, .5
        text: &#39;btn_4&#39;
</code></pre>
<h3 id="PageLayout-布局"><a href="#PageLayout-布局" class="headerlink" title="PageLayout 布局"></a>PageLayout 布局</h3><p>PageLayou布局和前面几种布局方式是有差异的，他更倾向与动态布局，使用这个布局可以创建一个简单的多页面布局。可以在这些布局之间随意跳转，此布局每个子部件都作为一个单独的页面，所以此布局并不支持<code>size_hint</code>和<code>pos_hint</code>：<br>例如如下:<br>会生成一个可以自由左右拉的按钮。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.pagelayout <span class="keyword">import</span> PageLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageLayoutWidget</span>(<span class="title class_ inherited__">PageLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(PageLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line">        btn = Button(text=<span class="string">&#x27;btn1&#x27;</span>, background_color=[<span class="number">0.3</span>,<span class="number">.9</span>,<span class="number">.2</span>,<span class="number">1</span>])</span><br><span class="line">        btn2 = Button(text=<span class="string">&#x27;btn2&#x27;</span>, background_color=[<span class="number">.1</span>,<span class="number">.5</span>,<span class="number">.4</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_widget(btn)</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(btn2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageLayoutPyApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> PageLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    PageLayoutPyApp().run()</span><br></pre></td></tr></table></figure>

<p>KV实现布局</p>
<pre><code># pagelayout.kv
&lt;PageLayoutWidget&gt;
    border: &#39;100dp&#39;  # 设置边界，如果不设置默认为50dp
    Button:
        text:&#39;Page0&#39;
        background_color: 0.3, .2, .5, 1

    Button:
        text:&#39;Page1&#39;
        background_color: 0.4, .4, .6, 1

    Button:
        text:&#39;Page2&#39;
        background_color: 0.6, .6, .8, 1

    Button:
        text:&#39;Page3&#39;
        background_color: 0.8, .8, 1, 1
</code></pre>
<p>Python配合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.pagelayout <span class="keyword">import</span> PageLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageLayoutWidget</span>(<span class="title class_ inherited__">PageLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(PageLayoutWidget, <span class="variable language_">self</span>).__init__()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PageLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> PageLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    PageLayoutApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="PageLayout布局基本属性"><a href="#PageLayout布局基本属性" class="headerlink" title="PageLayout布局基本属性"></a>PageLayout布局基本属性</h4><ul>
<li><code>border</code> : 指定两边边界大小，如果我们没有指定的话默认是<code>50dp</code>.前面的kv中也对这进行写入，测试时可以将对应行去掉后进行测试。</li>
<li><code>page</code>: 设置默认显示哪一页、</li>
<li><code>swipe_threshold</code>： 设置翻页灵敏度 例如: <code>swipe_threshold: .8</code></li>
<li><code>anim_kwargs</code>: 属性设置’t‘翻页动画和’d‘持续时间，例如： <code>anim_kwargs: &#123;&#39;d&#39;:10, &#39;t&#39;: &#39;linear&#39;&#125;</code>。 这边t中有哪些参数暂时不做过多说明，后期会细说。</li>
</ul>
<p>可以尝试下，当以上属性都设置了，页面之间切换的动画被延长到10秒了，并且翻页的灵敏度也要滑动到80%时以上才会被判定为翻页的动作。</p>
<h3 id="RelativeLayout布局"><a href="#RelativeLayout布局" class="headerlink" title="RelativeLayout布局"></a>RelativeLayout布局</h3><p>相对布局，此布局的操作方式与前面的FloatLayout基本是相同的，只是在定位的时候我们使用的<code>x,center_x,right,y,center_y,top</code>这些属性是想对于他的父布局的，而不是相对于窗口。<br>其实任何布局，当布局的位置属性更改时，小部件都会移动。<br>接下来我们看看如何初始化一个RelativeLayou布局。<br>老样子，使用python代码和kv代码文件两种方式实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.relativelayout <span class="keyword">import</span> RelativeLayout</span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Color, Rectangle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyButton</span>(<span class="title class_ inherited__">Button</span>):</span><br><span class="line">    <span class="comment"># 自定义按钮属性，将公共属性提出来</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(MyButton, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line">        <span class="variable language_">self</span>.font_size = <span class="number">20</span></span><br><span class="line">        <span class="variable language_">self</span>.size_hint = [<span class="number">.2</span>, <span class="number">.2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RelativelayoutWidget</span>(<span class="title class_ inherited__">RelativeLayout</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            Color(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="variable language_">self</span>.rect = Rectangle(pos=<span class="variable language_">self</span>.pos, size=<span class="variable language_">self</span>.size)</span><br><span class="line">            <span class="comment"># 绑定事件</span></span><br><span class="line">            <span class="variable language_">self</span>.bind(pos=<span class="variable language_">self</span>.update_rect, size=<span class="variable language_">self</span>.update_rect)</span><br><span class="line"></span><br><span class="line">        box_relative = RelativelayoutWidget()</span><br><span class="line"></span><br><span class="line">        btn1 = MyButton(text=<span class="string">&#x27;btn1&#x27;</span>, pos_hint=&#123;<span class="string">&#x27;right&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;top&#x27;</span>: <span class="number">1</span>&#125;, background_color=(<span class="number">.1</span>, <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">1</span>))</span><br><span class="line">        btn2 = MyButton(text=<span class="string">&#x27;btn2&#x27;</span>, pos_hint=&#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;top&#x27;</span>: <span class="number">1</span>&#125;, background_color=(<span class="number">.1</span>, <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">1</span>))</span><br><span class="line">        RelativeBtn3 = MyButton(text=<span class="string">&#x27;RelativeBtn3&#x27;</span>, pos_hint=&#123;<span class="string">&#x27;center_x&#x27;</span>: <span class="number">.5</span>, <span class="string">&#x27;center_y&#x27;</span>: <span class="number">.5</span>&#125;,</span><br><span class="line">                                background_color=(<span class="number">.1</span>, <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">1</span>))</span><br><span class="line">        RelativeBtn4 = MyButton(text=<span class="string">&#x27;RelativeBtn4&#x27;</span>, pos_hint=&#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">0</span>&#125;, background_color=(<span class="number">.1</span>, <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">1</span>))</span><br><span class="line">        RelativeBtn5 = MyButton(text=<span class="string">&#x27;RelativeBtn5&#x27;</span>, pos_hint=&#123;<span class="string">&#x27;right&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">                                background_color=(<span class="number">.1</span>, <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [btn1, btn2, RelativeBtn3, RelativeBtn4, RelativeBtn5]:</span><br><span class="line">            box_relative.add_widget(i)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.add_widget(BoxLayout())</span><br><span class="line">        <span class="variable language_">self</span>.add_widget(box_relative)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_rect</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="comment"># 设置背景尺寸， 可忽略</span></span><br><span class="line">        <span class="variable language_">self</span>.rect.pos = <span class="variable language_">self</span>.pos</span><br><span class="line">        <span class="variable language_">self</span>.rect.size = <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RelativeLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    RelativeLayoutApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上代码运行后，会出现半边是空白，另外半边是有在四个角落和中间五个按钮，那是因为我们把按钮在第42行的时候，全部加在了<code>Relativelayout</code>布局内了，然后右边放空一个<code>BoxLayout</code>布局进行占位，不加任何控件，因为<code>Relativelayout</code>布局里面的控件是按照<code>Relativelayout</code>布局的位置和大小进行定位的，并非按照我们最开始初始化的大的那个<code>BoxLayout</code>布局进行定位的，所以里面的控件都是相对于<code>Relativelayout</code>布局的位置进行放置。<br>接下一样，我们用kv文件配合python 的方式去实现上面的样子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RelativeLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    RelativeLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>kv代码</p>
<pre><code>&lt;Button&gt;
    font_size:20
    size_hint: .2,.3

&lt;BoxLayoutWidget&gt;

    canvas:
        Color:
            rgba: 1,1,1,1

        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:

    RelativeLayout:
        Button:
            text:&quot;btn1&quot;
            background_color: .1,.2,.3,1
            pos_hint:&#123;&#39;right&#39;:1, &#39;top&#39;:1&#125;

        Button:
            text:&quot;btn2&quot;
            background_color: .1,.2,.3,1
            pos_hint:&#123;&#39;x&#39;: 0, &#39;top&#39;: 1&#125;

        Button:
            text:&quot;RelativeBtn3&quot;
            background_color: .1,.2,.3,1
            pos_hint:&#123;&#39;center_x&#39;: .5, &#39;center_y&#39;: .5&#125;

        Button:
            text:&quot;RelativeBtn4&quot;
            background_color: .1,.2,.3,1
            pos_hint:&#123;&#39;x&#39;: 0, &#39;y&#39;: 0&#125;

        Button:
            text:&quot;RelativeBtn5&quot;
            background_color: .1,.2,.3,1
            pos_hint:&#123;&#39;right&#39;: 1, &#39;y&#39;: 0&#125;
</code></pre>
<h3 id="ScatterLayout-分散布局"><a href="#ScatterLayout-分散布局" class="headerlink" title="ScatterLayout 分散布局"></a>ScatterLayout 分散布局</h3><p><code>ScatterLayout</code>布局与<code>RelativeLayout</code>布局相似，当变更位置的时候，布局内的小部件也会随着父布局一起相对更改，因为这个布局主要由<code>Scatter</code>小部件实现，所以是可以实现自由的平移，旋转，缩放等布局的。<br>我们来看下， 使用Python是如何实现的。</p>
<pre><code># !/usr/bin/env python3
# -*- coding: utf-8 -*-

from kivy.uix.boxlayout import BoxLayout
from kivy.app import App
from kivy.uix.scatterlayout import ScatterLayout
from kivy.uix.image import AsyncImage
from kivy.graphics import Rectangle, Color


class ScatterLayoutWidget(ScatterLayout):
    pass


class BoxLayoutWidget(BoxLayout):
    def __init__(self, **kwargs):
        super(BoxLayoutWidget, self).__init__(**kwargs)

        with self.canvas:
            Color(1, 1, 1, 1)
            self.rect = Rectangle(pos=self.pos, size=self.size)
            self.bind(pos=self.update_rect, size=self.update_rect)

        scatter_layout = ScatterLayoutWidget()

        image = AsyncImage(source=&#39;https://blogcdn.sea-whales.cn/blog/typecho/11.jpg&#39;)

        scatter_layout.add_widget(image)

        self.add_widget(scatter_layout)

    def update_rect(self, *args):
        self.rect.pos = self.pos
        self.rect.size = self.size


class ScatterLayoutApp(App):
    def build(self):
        return BoxLayoutWidget()


if __name__ == &#39;__main__&#39;:
    ScatterLayoutApp().run()
</code></pre>
<p>运行以上python代码，将会出现一个图片，且在窗体中间加载，我们可以使用鼠标单击图片，模拟手指点击进行图片的拖动和缩放、旋转操作。</p>
<p>kv配合python实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ScatterLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ScatterLayoutApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kv文件</p>
<pre><code>&lt;BoxLayoutWidget&gt;
    canvas:
        Color:
            rgba: 1,1,1,1

    ScatterLayout:
        AsyncImage:
            source: &#39;https://blogcdn.sea-whales.cn/blog/typecho/11.jpg&#39;

    ScatterLayout:
        Image:
            source: &#39;scatter_image.jpg&#39;
</code></pre>
<h3 id="StackLayout-堆栈布局"><a href="#StackLayout-堆栈布局" class="headerlink" title="StackLayout 堆栈布局"></a>StackLayout 堆栈布局</h3><p>堆栈布局中只要不超过布局的范围，就可以进行垂直或者水平的排列子项，并且各个小部件的大小可以不需要相同，<code>StackLayout</code>布局可以通过<code>orientation</code>属性进行指定布局方向，默认值为<code>lr-tb</code>。<br>我们看看堆栈排列有哪些排序排列。</p>
<ul>
<li>按行排列：<code>lr-tb</code>,<code>lr-bt</code>,<code>rl-tb</code>,<code>rl-bt</code></li>
<li>按列排序：<code>tb-lr</code>,<code>bt-lr</code>,<code>tb-rl</code>,<code>bt-rl</code></li>
</ul>
<p>我们看看上面的l、r、t、b 分别代表什么。</p>
<ul>
<li>l 代表的是’left’的缩写，代表左</li>
<li>r 代表的是’right’的缩写，代表右</li>
<li>t 代表的是’top’的缩写，代表上</li>
<li>b 代表的是’bottom’的缩写，代表下</li>
</ul>
<p>那么我们就可以将’lr’理解为从左到右，’tb’理解为从上到下，以此类推。<br>‘lr-tb’可以看成先按行从左到右，当前窗口行满后再按列从上到下，那么’tb-lr’则可以看成先按列从上到下，当前窗口列满后，按从左到右排列。其他方式，以此类推。</p>
<p>接下来我们来写一个’lr-tb’排列，不同大小的布局，且按照’lr-tb’方式布局长度递增。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.button <span class="keyword">import</span> Button</span><br><span class="line"><span class="keyword">from</span> kivy.uix.stacklayout <span class="keyword">import</span> StackLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Rectangle, Color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StackLayoutWidget</span>(<span class="title class_ inherited__">StackLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="variable language_">self</span>.orientation = <span class="string">&#x27;lr-tb&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>(StackLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            Color(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)  <span class="comment"># 设置底色为白色</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.rect = Rectangle(size=<span class="variable language_">self</span>.size, pos=<span class="variable language_">self</span>.pos)</span><br><span class="line">            <span class="variable language_">self</span>.bind(size=<span class="variable language_">self</span>.update_rect, pos=<span class="variable language_">self</span>.update_rect)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">            <span class="comment"># 将按钮的高度控制在20%，长度初始为50，随着按钮越多按钮越大递增。</span></span><br><span class="line">            btn = Button(text=<span class="string">f&#x27;Btn_f<span class="subst">&#123;i&#125;</span>&#x27;</span>, width=<span class="number">50</span> + i * <span class="number">8</span>, size_hint=(<span class="literal">None</span>, <span class="number">0.20</span>))  </span><br><span class="line">            <span class="variable language_">self</span>.add_widget(btn)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_rect</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rect.pos = <span class="variable language_">self</span>.pos</span><br><span class="line">        <span class="variable language_">self</span>.rect.size = <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StackLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> StackLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    StackLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>前面已经写了很多从Python 文件改为Python和kv文件配合的情况了，这个我就不单独写了。<br>我们来看看<code>StackLayout</code>有哪些属性。</p>
<ul>
<li><code>orientation</code>: 前面我们说过，这个属性是用于决定布局内子部件的排列方式，也说明了具体有哪些属性。</li>
<li><code>padding</code>：这个属性有看前面的也不陌生，是用于控制布局和部件之间的间距的参数。接受的是一个<code>list</code>,可以是四个和两个和一个。四个时分别是<code>[padding_left, padding_top, padding_right, padding_bottom]</code> 左、上、右、下 。两个时分别是<code>[padding_horizontal,padding_vertical]</code>  水平、垂直 两个方向。一个时代表控件四个方向的间距。他们的默认值都为<code>0</code></li>
<li><code>spacing</code>: 这属性和前面的属性也是一样的用于控制部件和部件之间间距。他可以接受两个和一个参数，也是list。不同数量参数和<code>padding</code>表示的一致。</li>
</ul>
<p>以上三个参数<code>StackLayout</code>常用的属性，还有几个就是布局会根据子部件自动设置一些属性。我们来看下分别是哪些（顾名思义即可）：</p>
<ul>
<li><code>minimum_height</code>：最低高度。</li>
<li><code>minimum_width</code>: 最小宽度</li>
<li><code>minimum_size</code>：最小尺寸（可同时设置最低高度和最小宽度）</li>
</ul>
<p>以上就是<code>StackLayout</code>参见的属性，就不做例子进行解释了。如果是按照前面一步步看过来的，也能很快理解意思。</p>
<h3 id="例子：计时器"><a href="#例子：计时器" class="headerlink" title="例子：计时器"></a>例子：计时器</h3><h4 id="布局-1"><a href="#布局-1" class="headerlink" title="布局"></a>布局</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># !/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from kivy.app import App</span><br><span class="line">from kivy.uix.boxlayout import BoxLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ClockBoxLayout(BoxLayout):</span><br><span class="line">    def __init__(self, **kwargs):</span><br><span class="line">        super(ClockBoxLayout, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ClockApp(App):</span><br><span class="line">    def build(self):</span><br><span class="line">        return ClockBoxLayout()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    # 设置页面背景</span><br><span class="line">    from kivy.core.window import Window</span><br><span class="line"></span><br><span class="line">    Window.clearcolor = [.8, .8, .8, 1]</span><br><span class="line">    ClockApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kv文件</p>
<pre><code>&lt;ClockBoxLayout&gt;:
    orientation: &#39;vertical&#39;

    Label:
        id: time_label_id
        text: &#39;[b]00[/b]:00:00&#39;
        font_size: 60
        markup: True
</code></pre>
<h4 id="计时器"><a href="#计时器" class="headerlink" title="计时器"></a>计时器</h4><p>具有暂停和重置功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> strftime</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.anchorlayout <span class="keyword">import</span> AnchorLayout</span><br><span class="line"><span class="keyword">from</span> kivy.clock <span class="keyword">import</span> Clock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClockBoxLayout</span>(<span class="title class_ inherited__">AnchorLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(ClockBoxLayout, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line">        <span class="variable language_">self</span>.timing_flag = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.timing_seconds = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.on_start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 设置clock 每0秒执行一次，代表实时进行不间断刷新。</span></span><br><span class="line">        Clock.schedule_interval(<span class="variable language_">self</span>.update_time, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_time</span>(<span class="params">self, nap</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.timing_flag:</span><br><span class="line">            <span class="variable language_">self</span>.timing_seconds += nap</span><br><span class="line">        <span class="comment"># 通过ID获取time_label_id的控件，并且设置text的属性值</span></span><br><span class="line">        <span class="variable language_">self</span>.ids.time_label_id.text = strftime(<span class="string">&#x27;[b]%H[/b]:%M:%S&#x27;</span>)</span><br><span class="line">        m, s = <span class="built_in">divmod</span>(<span class="variable language_">self</span>.timing_seconds, <span class="number">60</span>)</span><br><span class="line">        <span class="variable language_">self</span>.ids.stopwatch.text = (<span class="string">&#x27;%02d:%02d.[size=40]%02d[/size]&#x27;</span> % (<span class="built_in">int</span>(m), <span class="built_in">int</span>(s), <span class="built_in">int</span>(s * <span class="number">100</span> % <span class="number">100</span>)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_on_stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.ids.start_stop_button_id.text = <span class="string">&#x27;Start&#x27;</span> <span class="keyword">if</span> <span class="variable language_">self</span>.timing_flag <span class="keyword">else</span> <span class="string">&#x27;Stop&#x27;</span></span><br><span class="line">        <span class="variable language_">self</span>.timing_flag = <span class="keyword">not</span> <span class="variable language_">self</span>.timing_flag</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset_clock</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.timing_flag:</span><br><span class="line">            <span class="variable language_">self</span>.ids.start_stop_button_id.text = <span class="string">&#x27;Start&#x27;</span></span><br><span class="line">            <span class="variable language_">self</span>.timing_flag=<span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.timing_seconds = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClockApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> ClockBoxLayout()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 设置页面背景</span></span><br><span class="line">    <span class="keyword">from</span> kivy.core.window <span class="keyword">import</span> Window</span><br><span class="line"></span><br><span class="line">    Window.clearcolor = [<span class="number">.8</span>, <span class="number">.8</span>, <span class="number">.8</span>, <span class="number">1</span>]</span><br><span class="line">    ClockApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kv文件</p>
<pre><code>&lt;MyButton@Button&gt;
    font_size: 25
    bold: True
    border: (2,2,2,2)

&lt;ClockBoxLayout&gt;:
    # 异步加载背景图像 
    AsyncImage:
        source: &#39;https://blogcdn.sea-whales.cn/blog/typecho/11.jpg&#39;

    BoxLayout:
        # 设置布局
        orientation: &#39;vertical&#39;

        Label:
            id: time_label_id   # 添加ID属性，通过ID属性进行对控件的获取
            text: &#39;[b]00[/b]:00:00&#39;
            font_size: 60
            markup: True   # 

        BoxLayout:
            orientation: &#39;horizontal&#39;
            padding: 20
            spacing: 20
            size_hint:(1, None)
            height: 90

            MyButton:
                id: start_stop_button_id 
                text:&#39;start&#39;
                on_press: root.start_on_stop()

            MyButton:
                text: &#39;Reset&#39;
                on_press: root.reset_clock()  # 触发事件

        Label:
            id: stopwatch
            text: &#39;00:00.[size=40]00[/size]&#39;
            font_size: 60
            markup: True
</code></pre>
<h2 id="图形绘制"><a href="#图形绘制" class="headerlink" title="图形绘制"></a>图形绘制</h2><h4 id="页面背景"><a href="#页面背景" class="headerlink" title="页面背景"></a>页面背景</h4><p>看过布局的朋友们，一定发现了，在创建一个widget控件后，为布局设置背景色或者经常会有一个<code>with self.canvas</code>并且加了几个属性和绑定了事件，这些其实是我们在生成一个控件后，Kivy自动生成的一个类似画布的。我们通过对画布的更改可以设置颜色、尺寸、背景图等。<br>这里说明一下，canvas 学过HTML5的同学肯定觉得眼熟，但是实际两个是不相同的。<br>HTML的Canvas的定义是：</p>
<blockquote>
<p>HTML5 的 canvas 元素使用 JavaScript 在网页上绘制图像。<br>画布是一个矩形区域，您可以控制其每一像素。<br>canvas 拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。</p>
</blockquote>
<p>而Kivy的Canvas本质是一组在坐标空间的指令容器，可以理解成坐标空间中一个无限的绘画板，通过添加指令来绘制图形。<br>我们先来使用纯色进行设置背景。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Rectangle, Color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            Color(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            Rectangle(pos=<span class="variable language_">self</span>.pos, size=<span class="variable language_">self</span>.size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    BoxLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>运行上面代码可以发现，在布局中，左下角有一块100*100的白色小方块,这时候我们就完成了基础的颜色设置，但是我们需要把白色填满整个方块。其实以上代码的操作是初始化一个BoxLayou然后，初始化后其实一个黑色的背景，然后在with里面新加一个画布，对画布初始化为白色背景。如果我们要填满整个窗口只需要在初始化好画布之后，对画布进行大小重定义即可实现覆盖。参考如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Rectangle, Color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            <span class="comment"># 设置颜色值，通常百分比形式比较难把握，我们可以选择将rgb的色值除255，</span></span><br><span class="line">            <span class="comment"># 例如：海蓝宝石（#7FFFD4）色的rgb的色值是（127，255，212）写成Kivy的Color就写成</span></span><br><span class="line">            <span class="comment"># Color(127/255,255/255,212/255,0)，最后一个值是设置透明度的一般选择0~1之间的值。</span></span><br><span class="line">            <span class="comment"># 0不透明，1为透明</span></span><br><span class="line">            Color(<span class="number">127</span> / <span class="number">255</span>, <span class="number">255</span> / <span class="number">255</span>, <span class="number">212</span> / <span class="number">255</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="variable language_">self</span>.rect = Rectangle(pos=<span class="variable language_">self</span>.pos, size=<span class="variable language_">self</span>.size)</span><br><span class="line">            <span class="variable language_">self</span>.bind(pos=<span class="variable language_">self</span>.update_rect, size=<span class="variable language_">self</span>.update_rect)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_rect</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="variable language_">self</span>.rect.pos = <span class="variable language_">self</span>.pos</span><br><span class="line">        <span class="variable language_">self</span>.rect.size = <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    BoxLayoutApp().run()</span><br></pre></td></tr></table></figure>

<p>老样子，我们看看KV文件配合的情况下如何实现以上样子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoxLayoutWidget</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(BoxLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ColorApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BoxLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ColorApp().run()</span><br></pre></td></tr></table></figure>

<p>kv文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;BoxLayoutWidget&gt;</span><br><span class="line">    canvas:</span><br><span class="line">        Color:</span><br><span class="line">            rgba: [127 / 255, 255 / 255, 212 / 255, 1]</span><br><span class="line"></span><br><span class="line">        Rectangle:</span><br><span class="line">            size: self.size</span><br><span class="line">            pos: self.pos</span><br></pre></td></tr></table></figure>

<p>还可以在有底色的情况下，使用背景图片。<br>只需把前面Python代码中19行新增一个参数即可如下：</p>
<pre><code>self.rect = Rectangle(pos=self.pos, size=self.size, source=&#39;canvas_image.jpg&#39;)
</code></pre>
<p>或者kv文件中<code>Rectangle</code>下新增<code>source: &#39;canvas_image.jpg&#39;</code>，其中<code>canvas_image.jpg</code>是图片名称和地址。</p>
<h4 id="基本图形绘制"><a href="#基本图形绘制" class="headerlink" title="基本图形绘制"></a>基本图形绘制</h4><p>前面，我们使用纯色背景以及使用图片来将<code>Canvas</code>这个画布进行上色和调整等，接下来我们试试在画好的画布中进行简单图形的绘制，比如。矩形、椭圆等</p>
<h5 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h5><p>其实我们前面也一直在画这个矩形，只是有的部分把他填充了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># !/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from kivy.uix.relativelayout import RelativeLayout</span><br><span class="line">from kivy.app import App</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class RelativeWidget(RelativeLayout):</span><br><span class="line">    def __init__(self, **kwargs):</span><br><span class="line">        super(RelativeWidget, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DrawRectangleApp(App):</span><br><span class="line">    def build(self):</span><br><span class="line">        return RelativeWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    DrawRectangleApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>drawrectangle.kv</p>
<pre><code>&lt;RelativeWidget&gt;
    canvas:
        Color:
            rgba: [1,1,1,1]
        Rectangle:
            size: self.width*0.2, self.height*.15
            pos: self.x+10, self.y+10
</code></pre>
<h5 id="椭圆"><a href="#椭圆" class="headerlink" title="椭圆"></a>椭圆</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># !/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from kivy.uix.relativelayout import RelativeLayout</span><br><span class="line">from kivy.app import App</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class RelativeWidget(RelativeLayout):</span><br><span class="line">    def __init__(self, **kwargs):</span><br><span class="line">        super(RelativeWidget, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DrawEllipseApp(App):</span><br><span class="line">    def build(self):</span><br><span class="line">        return RelativeWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    DrawEllipseApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>drawellipse.kv</p>
<pre><code>&lt;RelativeWidget&gt;
    canvas:
        Color:
            rgba: [1,1,1,1]
        Ellipse:
            size: self.width*.35, self.height*.35
            pos: self.x+250, self.top-400
</code></pre>
<h5 id="半圆及多边形"><a href="#半圆及多边形" class="headerlink" title="半圆及多边形"></a>半圆及多边形</h5><p>其实半圆的画法和椭圆基本一致。只是增加了三个新属性。</p>
<ul>
<li><code>angle_start</code>: 开始线角度，开始方向与y轴的角度。</li>
<li><code>angle_end</code>: 结束线角度，结束方向与y轴的角度。一般<code>angle_end</code>的大小要大于<code>angle_start</code>,若不大于则需要加 360° ，此时Kivy会顺时针画图形。否则则是逆时针画图形。</li>
<li><code>egments</code>: 多边形的边数，可以用来画三角形，六边形等形状。</li>
</ul>
<p>例如,我们改下前面的椭圆，在它旁边加多一个六边形，一个三角形以及一个扇形还有正圆。Python代码我们继续使用椭圆的代码。改下Kv代码就好：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeWidget&gt;</span><br><span class="line">    canvas:</span><br><span class="line">        Color:</span><br><span class="line">            rgba: [1,1,1,1]</span><br><span class="line">        Ellipse:  # 正圆</span><br><span class="line">            size: self.width*0.20, self.width*0.20</span><br><span class="line">            pos: self.x+20, self.top-200</span><br><span class="line"></span><br><span class="line">        Ellipse:  # 正六边形</span><br><span class="line">            size: self.height*0.25, self.height*0.25</span><br><span class="line">            pos: self.x+200, self.top-200</span><br><span class="line">            segments: 6</span><br><span class="line"></span><br><span class="line">        Ellipse:  # 超过180°的顺时针扇形</span><br><span class="line">            size: self.width*0.25, self.height*.25</span><br><span class="line">            pos: self.x+400, self.top-200</span><br><span class="line">            angle_start: 120</span><br><span class="line">            angle_end: 420</span><br><span class="line"></span><br><span class="line">        Ellipse:  # 正三角</span><br><span class="line">            size: self.height*.25, self.height*.25</span><br><span class="line">            pos: self.x+400, self.top-400</span><br><span class="line">            segments: 3</span><br><span class="line"></span><br><span class="line">        Ellipse:  # 正半圆</span><br><span class="line">            size: self.height*0.25, self.height*.25</span><br><span class="line">            pos: self.x+200, self.top-400</span><br><span class="line">            angle_start: 0</span><br><span class="line">            angle_end: 180</span><br><span class="line"></span><br><span class="line">        Ellipse:  # 椭圆</span><br><span class="line">            size: self.height*0.30, self.width*.15</span><br><span class="line">            pos: self.x+20, self.top-400</span><br></pre></td></tr></table></figure>

<h5 id="多边形"><a href="#多边形" class="headerlink" title="多边形"></a>多边形</h5><p>前面使用了画圆的方式使用参数<code>segments</code>来画多边形，这些多变形画出来它的边长是随着圆的尺寸决定的，长度是不能自己决定的。<br>Kivy还提供了一种方式，用于指定各边的顶点坐标，可以绘制特殊边的多边形，但是值支持四个坐标点，可用于菱形、平行四边形、梯形等。</p>
<p>一样，我们值更改Kv文件如下：</p>
<pre><code>&lt;RelativeWidget&gt;
    canvas:
        Color:
            rgba: [1,1,1,1]

        Quad:
            points: 400,250, 640,280, 480,500, 380,520  # 设置顶点坐标。 按X轴，Y轴的顺序读取顶点坐标。
</code></pre>
<p><code>Quad</code>中的<code>points</code>会按照x轴,y轴的的顺序，读取点的位置，并且在画布<code>canvas</code>上绘制一个多边形。</p>
<h5 id="点和线"><a href="#点和线" class="headerlink" title="点和线"></a>点和线</h5><p>kv文件</p>
<pre><code>&lt;RelativeWidget&gt;
    canvas:
        Color:
            rgba: [1,1,1,1]

        Line:
            points: 310,350, 310,280,  360,350, 510,350

        Point:
            points:300,200, 300,400
            pointsize: 5
</code></pre>
<p>其实就像数学里面理解的，所有的线是由无数个点挨着排列形成的，同理面是由线挨着排列形成的。我们也可以用点和线画前面的图形。<br>例如:</p>
<pre><code>&lt;RelativeWidget&gt;
    canvas:
        Color:
            rgba: [1,1,1,1]

        Line:  # 线
            points: 110,150, 310,80

        Point: # 点
            points:100,200, 180,260
            pointsize: 5  # 点大小

        Line: # 椭圆
            ellipse: 210,320, 80,60, 120,420,180
            width: 2  # 线宽

        Line: # 圆
            circle: 350,350, 40,0, 360,180
            width: 1.5 

        Line: # 矩形
            rectangle: 410,310, 80, 70

        Line:
            points: 510,310, 540,390, 590,320
            close: True  # 是否闭合
</code></pre>
<p>KV中Line对应参数说明：</p>
<ul>
<li>ellipse：210， 320 表示椭圆的位置；80， 60 代表椭圆的宽和长；120， 420，180分别对应： angel_start, angel_end, segments.</li>
<li>circle: 350，350 表示圆心的位置；40表示圆的半径；0，360，180分别对应： angel_start, angel_end, segments.</li>
<li>rectangle: 420, 310 表示矩形位置左下角的顶点； 80，70，代表宽高</li>
<li>points： 510， 310  代表第一个点的位置，以此类推。</li>
</ul>
<h4 id="Cancas-属性"><a href="#Cancas-属性" class="headerlink" title="Cancas 属性"></a>Cancas 属性</h4><p>前面我们已经初步了解了<code>Canvas</code>画布基本绘制功能。我们来深入了解下他有哪些属性。<br>在Kivy里，每个小部件和布局基本都有他的<code>Canvas</code>、<code>Canvas.before</code>和<code>canvas.after</code>,其实我们可以将<code>canvas</code>看作在坐标空间种，一个无限的绘图板，通过添加绘图指令来绘制想要的图形。<strong>Kivy的所有部件都是共享一个坐标空间的，且不限于窗口或者屏幕的大小。</strong><br>我们前面学习的时候也已经试过给画布和小部件设置背景以及显示的颜色。而且我们还能添加不同<code>Instructions</code>指令来达到不同的页面效果。</p>
<pre><code># !/usr/bin/env python3
# -*- coding: utf-8 -*-

from kivy.app import App
from kivy.uix.relativelayout import RelativeLayout
from kivy.graphics import Rectangle, Color
from kivy.graphics.instructions import InstructionGroup


class RelativeWidget(RelativeLayout):
    def __init__(self, **kwargs):
        super(RelativeWidget, self).__init__(**kwargs)
        blue = InstructionGroup()
        blue.add(Color(1, 0, 0, .6))
        blue.add(Rectangle(pos=self.pos, size=(300,300)))
        self.canvas.add(blue)

        green = InstructionGroup()
        green.add(Color(0, 1, 0, 0.4))
        green.add(Rectangle(pos=(300, 300), size=(300, 300)))
        self.canvas.add(green)


class AttributeApp(App):
    def build(self):
        return RelativeWidget()


if __name__ == &#39;__main__&#39;:
    AttributeApp().run()
</code></pre>
<p>通常情况，我们在使用完<code>canvas</code>画布后，还需使用<code>clear（）</code>方法清除所有加载在画布种的<code>Instructions</code>指示类型。<br>我们可以把上面的代码改成<code>with</code>语法,效果是一致的。</p>
<pre><code># !/usr/bin/env python3
# -*- coding: utf-8 -*-

from kivy.app import App
from kivy.uix.relativelayout import RelativeLayout
from kivy.graphics import Rectangle, Color
from kivy.graphics.instructions import InstructionGroup


class RelativeWidgetWith(RelativeLayout):
    def __init__(self, **kwargs):
        super(RelativeWidgetWith, self).__init__(**kwargs)
        with self.canvas:
            Color(1, 0, 0, .6)
            Rectangle(pos=self.pos, size=(300, 300))

            Color(0, 1, 0, 0.4)
            Rectangle(pos=(300, 300), size=(300, 300))


class AttributeApp(App):
    def build(self):
        return RelativeWidgetWith()


if __name__ == &#39;__main__&#39;:
    AttributeApp().run()
</code></pre>
<p>还有一些常用的属性：</p>
<table>
<thead>
<tr>
<th>Canvas属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>add(Instructions c)</td>
<td>将Instructions类型的c添加到Canvas中</td>
</tr>
<tr>
<td>clear()</td>
<td>删除所有Instructions</td>
</tr>
<tr>
<td>get_group(str groupname)</td>
<td>返回特定组下所有Instructions</td>
</tr>
<tr>
<td>insert(int index, Instructions c)</td>
<td>指定位置插入c</td>
</tr>
<tr>
<td>indexof(Instructions c)</td>
<td>返回c下标</td>
</tr>
<tr>
<td>length()</td>
<td>返回canvas的长度</td>
</tr>
<tr>
<td>remove()</td>
<td>删除指定的c</td>
</tr>
<tr>
<td>remove_group(str groupname)</td>
<td>删除该组下所有的c</td>
</tr>
</tbody></table>
<p>在Kivy每个小部件都有属性<code>canvas</code>，除了这个包括有<code>canvas.before</code>和<code>canvas.after</code>属性，用法的话基本和canvas一致。只是在运行顺序上的优先级不同。<br>大概顺序是：</p>
<ul>
<li><strong>canvas.before &gt; canvas &gt; widget(canvas.befor,canvas,canvas.after) &gt; canvas.after</strong></li>
</ul>
<h4 id="旋转、平移和缩放空间坐标"><a href="#旋转、平移和缩放空间坐标" class="headerlink" title="旋转、平移和缩放空间坐标"></a>旋转、平移和缩放空间坐标</h4><p>在canvas 中是可以使用<code>Rotate</code>指令来控制旋转操作，他与<code>ScatterLayout</code>布局不同，它是对整个坐标空间，因此所有的子部件都是会受到影响。在使用整个参数时，需要指定三个参数;</p>
<ul>
<li>axis: 设置用于旋转的轴，通常为z轴（0，0，1）</li>
<li>angle： 设置旋转度数</li>
<li>origin： 设置旋转参考点</li>
</ul>
<p>来试试效果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 选择平移缩放</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.uix.gridlayout <span class="keyword">import</span> GridLayout</span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RotateGridLayoutWidget</span>(<span class="title class_ inherited__">GridLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(RotateGridLayoutWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RotateTranslateZoomApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> RotateGridLayoutWidget()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    RotateTranslateZoomApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>rotatetranslatezoom.kv</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyImage@Image&gt;</span><br><span class="line">    source:&#x27;rotatetranslatezoom.jpg&#x27;</span><br><span class="line">    pos: self.parent.pos</span><br><span class="line">    size_hit: .5, .4</span><br><span class="line">    canvas:</span><br><span class="line">        Color:</span><br><span class="line">            rgba: 1,0,0,.5</span><br><span class="line">        Line:</span><br><span class="line">            rectangle: self.x, self.y, self.width,self.height</span><br><span class="line"></span><br><span class="line">&lt;RotateGridLayoutWidget&gt;</span><br><span class="line">    cols: 2</span><br><span class="line">    canvas:</span><br><span class="line"></span><br><span class="line">        Color:</span><br><span class="line">            rgba:(1,1,1,1)</span><br><span class="line">        Rectangle:</span><br><span class="line">            pos: self.pos</span><br><span class="line">            size: self.size</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &#x27;col:1 row:1&#x27;</span><br><span class="line"></span><br><span class="line">    FloatLayout:</span><br><span class="line">        canvas:</span><br><span class="line">            Rotate:</span><br><span class="line">                axis:(0,0,1)</span><br><span class="line">                angle: 60</span><br><span class="line">                origin: self.center</span><br><span class="line">            Color:</span><br><span class="line">                rgba:(1,1,1,1)</span><br><span class="line">            Rectangle:</span><br><span class="line">                pos: self.pos</span><br><span class="line">                size: self.size</span><br><span class="line">        MyImage:</span><br><span class="line"></span><br><span class="line">    Button:</span><br><span class="line">        text: &#x27;col:1 row:2&#x27;</span><br></pre></td></tr></table></figure>

<p>以上布局，会出现两个按钮和一张图片。其中按钮按列排列。但是由于我们在<code>FloatLayout</code>中使用了<code>Rotate</code>这样导致了画布进行了旋转。我们看到的效果是图像是沿着中点，逆时针旋转了60度的情况。并且由于旋转的是在Button前面加入的，所以导致后方的空间坐标系也收到了影响，也连带着旋转了。而且点击第二个按钮黑色部分发现无效。而是需要点击按钮本身的位置，也就是第一个按钮的垂直排列的列下方才有效。为了避免这个情况，我们需要引入两个新的命令。</p>
<ul>
<li>PushMatrix ： 保存上下文环境。</li>
<li>PopMatrix ： 恢复上下文环境。<br>就像上面的栗子：<br>我们在对某个图像的画布或者其他进行操作的时候。就会导致代码排序在它之后的内容受到影响。这个时候我们就可以使用前面两个命令对环境进行保存和回复。<br>我们来改下KV文件：</li>
</ul>
<!---->

<pre><code>&lt;MyImage@Image&gt;
    source:&#39;rotatetranslatezoom.jpg&#39;
    pos: self.parent.pos
    size_hit: .5, .4
    canvas:
        PushMatrix
        Rotate:
            axis:(0,0,1)
            angle: 60
            origin: self.center
        Color:
            rgba: 1,0,0,.5
        Line:
            rectangle: self.x, self.y, self.width,self.height
        PopMatrix

&lt;RotateGridLayoutWidget&gt;
    cols: 2
    canvas:

        Color:
            rgba:(1,1,1,1)
        Rectangle:
            pos: self.pos
            size: self.size

    Button:
        text: &#39;col:1 row:1&#39;

    FloatLayout:
        MyImage:


    Button:
        text: &#39;col:1 row:2&#39;
</code></pre>
<p>以上文件运行后，会发现，红色矩形框旋转了60度。后面的按钮以及图像均不会受到影响，这是因为<code>Rotate</code>指令我们是放在<code>canvas</code>中的，是在屏幕上以及确定位置之后才开始执行的,并且在显示的时候，就使用前面的恢复环境命令恢复了。但是我们旋转的时候，就是为了让图像旋转。现在的情况却是图像并未旋转，这个时候，可以来试试前面我们学过的属性<code>canvas.befor</code>和<code>canvas.after</code>我们只需要在位置还没确定的时候，就旋转，这样图像就会在画布旋转之后进行图像的显示。这样就能达到指定效果了。我们在改动下KV文件:</p>
<pre><code>&lt;MyImage@Image&gt;
    source:&#39;rotatetranslatezoom.jpg&#39;
    pos: self.parent.pos
    size_hit: .5, .4
    canvas.before:  # 使用canvas.before 命令
        PushMatrix  # 保存当前上下文环境
        Rotate:
            axis:(0,0,1)  # 旋转
            angle: 60     # 角度
            origin: self.center  # 起点
    canvas:
        Color:
            rgba: 1,0,0,.5
        Line:
            rectangle: self.x, self.y, self.width,self.height

    canvas.after:
        PopMatrix  # 恢复上下文环境

&lt;RotateGridLayoutWidget&gt;
    cols: 2
    canvas:

        Color:
            rgba:(1,1,1,1)
        Rectangle:
            pos: self.pos
            size: self.size

    Button:
        text: &#39;col:1 row:1&#39;

    FloatLayout:
        MyImage:


    Button:
        text: &#39;col:1 row:2&#39;
</code></pre>
<p>使用上面的kv文件，就会发现图像和矩形框都一起旋转了。这样就达到了，旋转的同时连小部件也旋转。当然会发现我们为什么不把<code>PopMatrix</code>写在<code>canvas</code>的末行，而是大费周章的写个<code>canvas.after</code>，这里我就不解释了结合前面的知识点，大家可以尝试下，将<code>PopMatrix</code>写在canvas末行，看看是什么效果。</p>
<p>试过了旋转，我们来看看平移：<br><code>canvas</code>平移指令是<code>Translate</code>除了属性以外，该指令和我们前面用的<code>Rotate</code>指令基本是一致。<br>在使用<code>Translate</code>时，是需要指定X轴，Y轴，Z轴上的移动距离，如果不指定，则默认不移动。我们再拿前面的旋转代码给他加上平移属性看看。</p>
<pre><code>Translate:
    x: -50
    y: 100
    z:0
</code></pre>
<p>就不贴完整代码了，大概就是在Rotate属性结束下方另起一行，加上以上四行代码。我们会发现，图片的位置会向左平移了50个像素，将按钮盖住了，并且也向上移动了100个像素。如果这里我们将z轴的值进行改变，会发现图像不见了，这是因为图像的位置已经不在画布上了。<br>同理缩放（Scale）也是和前面一致，我们只需要指定xyz轴上的缩放倍数即可:</p>
<pre><code>Scale:
    xyz:(1.25,1.30,0.5)
</code></pre>
<p>如上，则是x轴和y轴分别缩放1.25和1.30.倍，z轴缩放0.5倍。</p>
<h4 id="实战–画板"><a href="#实战–画板" class="headerlink" title="实战–画板"></a>实战–画板</h4><p>我们先来做一个初始画板，先不添加其他复杂元素，来实现能写字的功能：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.widget <span class="keyword">import</span> Widget</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Line, Color</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DrawCanvasWidget</span>(<span class="title class_ inherited__">Widget</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(DrawCanvasWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置画笔的默认颜色为黑色&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.canvas.add(Color(rgb=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]))</span><br><span class="line">        <span class="variable language_">self</span>.line_width = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_touch_down</span>(<span class="params">self, touch</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;触摸显示轨迹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> Widget.on_touch_down(<span class="variable language_">self</span>, touch):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            touch.ud[<span class="string">&#x27;current_line&#x27;</span>] = Line(points=(touch.x, touch.y), width=<span class="variable language_">self</span>.line_width)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_touch_move</span>(<span class="params">self, touch</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;连线&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;current_line&#x27;</span> <span class="keyword">in</span> touch.ud:</span><br><span class="line">            touch.ud[<span class="string">&#x27;current_line&#x27;</span>].points += (touch.x, touch.y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaintApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.draw_canvas_widget = DrawCanvasWidget()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.draw_canvas_widget</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    PaintApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Kivy提供了<code>on_touch_down</code>和<code>on_touch_move</code>方法来实现监听屏幕点击和屏幕移动触发事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;DrawCanvasWidget&gt;:</span><br><span class="line">    canvas.before:</span><br><span class="line">        Color:</span><br><span class="line">            rgba:[1,1,1,1]</span><br><span class="line">        Rectangle:</span><br><span class="line">            pos: self.pos</span><br><span class="line">            size: self.size</span><br></pre></td></tr></table></figure>

<p>以上能够实现使用一种黑色画笔在白色画板上进行写字。接下来，我们试试能否通过选择颜色去替换画笔颜色，然后进行绘画。<br>Kivy种设置颜色的方法一般是使用rgba（r红色，g绿色，b蓝色，alpha名度）一般我们就是使用颜色和255进行比值，得到百分比。我们也可以直接使用十六进制进行表示。当需要大量颜色的时候，Kivy在utils包内也提供了 <code>get_color_from_hex()</code>方法进行16进制和百分比转换，我们使用当时时候传入十六进制字符串即可。<br>我们可以选择在python内使用，还是在kv文件内使用，使用方法如下：<br>python文件内：</p>
<pre><code>from kivy.utils import get_color_from_hex
get_color_from_hex(&#39;#98feab&#39;)
</code></pre>
<p>kv文件内使用:</p>
<pre><code>#:import C kivy.utils.get_color_from_hex
Button:
    background_color: C(&#39;#98feab&#39;)
</code></pre>
<p>我们可以在画板类里面写上一个方法来改变canvas画布颜色的方法。不是canvas.before背景：</p>
<pre><code>def chang_color(self, new_color):
    &quot;&quot;&quot;调色&quot;&quot;&quot;
    self.canvas.add(Color(*new_color))
</code></pre>
<p>通过<code>chang_color</code>方法在init中初始化一个颜色。在kv文件设置按钮，通过按钮单击调用<code>chang_color</code>激活颜色的改变。<br>具体代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.widget <span class="keyword">import</span> Widget</span><br><span class="line"><span class="keyword">from</span> kivy.graphics <span class="keyword">import</span> Line, Color</span><br><span class="line"><span class="keyword">from</span> kivy.utils <span class="keyword">import</span> get_color_from_hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DrawCanvasWidget</span>(<span class="title class_ inherited__">Widget</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(DrawCanvasWidget, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置画笔的默认颜色为黑色&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.change_color(get_color_from_hex(<span class="string">&#x27;#12aced&#x27;</span>))</span><br><span class="line">        <span class="variable language_">self</span>.line_width = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_touch_down</span>(<span class="params">self, touch</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;触摸显示轨迹&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> Widget.on_touch_down(<span class="variable language_">self</span>, touch):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.canvas:</span><br><span class="line">            touch.ud[<span class="string">&#x27;current_line&#x27;</span>] = Line(points=(touch.x, touch.y), width=<span class="variable language_">self</span>.line_width)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_touch_move</span>(<span class="params">self, touch</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;连线&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;current_line&#x27;</span> <span class="keyword">in</span> touch.ud:</span><br><span class="line">            touch.ud[<span class="string">&#x27;current_line&#x27;</span>].points += (touch.x, touch.y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">change_color</span>(<span class="params">self, new_color</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;调色&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.canvas.add(Color(*new_color))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaintApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.draw_canvas_widget = DrawCanvasWidget()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.draw_canvas_widget</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    PaintApp().run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kv文件</p>
<pre><code>#:import C kivy.utils.get_color_from_hex   # 引入颜色转换方法

&lt;BottomColorButton@ToggleButton&gt;:
    group: &#39;color&#39;
    background_normal: &#39;&#39;
    background_down: &#39;&#39;
    border: (3, 3, 3, 3)
    on_release: app.draw_canvas_widget.change_color(self.background_color)


&lt;DrawCanvasWidget&gt;:
    canvas.before:
        Color:
            rgba: [1, 1, 1, 1]
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        id: bottom_box
        orientation: &#39;horizontal&#39;
        padding: 2
        spacing: 2
        size: root.width, 40

        BottomColorButton:
            background_color: C(&#39;#19caad&#39;)
            state: &#39;down&#39;                     # 按钮状态

        BottomColorButton:
            background_color: C(&#39;#8cc7b5&#39;)

        BottomColorButton:
            background_color: C(&#39;#a0eee1&#39;)

        BottomColorButton:
            background_color: C(&#39;#bee7e9&#39;)

        BottomColorButton:
            background_color: C(&#39;#beedc7&#39;)

        BottomColorButton:
            background_color: C(&#39;#d6d5b7&#39;)

        BottomColorButton:
            background_color: C(&#39;#d1ba74&#39;)

        BottomColorButton:
            background_color: C(&#39;#e6ceac&#39;)

        BottomColorButton:
            background_color: C(&#39;#ecad9e&#39;)

        BottomColorButton:
            background_color: C(&#39;#f4606c&#39;)

        BottomColorButton:
            background_color: C(&#39;#3498db&#39;)

        BottomColorButton:
            background_color: C(&#39;#1abc9c&#39;)

        BottomColorButton:
            background_color: C(&#39;#2ecc71&#39;)

        BottomColorButton:
            background_color: C(&#39;#f1c40f&#39;)

        BottomColorButton:
            background_color: C(&#39;#e67e22&#39;)

        BottomColorButton:
            background_color: C(&#39;#e74c3c&#39;)

        BottomColorButton:
            background_color: C(&#39;#9b59bc&#39;)

        BottomColorButton:
            background_color: C(&#39;#ecf0f1&#39;)

        BottomColorButton:
            background_color: C(&#39;#95a5a6&#39;)

        BottomColorButton:
            background_color: C(&#39;#000000&#39;)
</code></pre>
<p>有了画笔颜色的改变，我们接下来看看改变画笔的粗细。<br>同理，使用与改变颜色相同方法做一个画笔粗细：</p>
<pre><code>    def change_line_width(self, line_width=&#39;Normal&#39;):
        self.line_width = &#123;&#39;Thin&#39;: 1, &#39;Normal&#39;: 2, &#39;Thick&#39;: 4&#125;[line_width]
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;LineWidthButton@ToggleButton&gt;:</span><br><span class="line">    group: &#x27;line_width&#x27;</span><br><span class="line">    color: C(&#x27;#2c3e50&#x27;)</span><br><span class="line">    background_color: C(&#x27;#ecf0f1&#x27;)</span><br><span class="line">    background_normal: &#x27;&#x27;</span><br><span class="line">    background_down: &#x27;&#x27;</span><br><span class="line">    border: (3, 3, 3, 3)</span><br><span class="line">    on_release: app.draw_canvas_widget.change_line_width(self.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>画布内新增改变按钮</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">BoxLayout:</span><br><span class="line">    orientation: &#x27;horizontal&#x27;</span><br><span class="line">    padding: 2</span><br><span class="line">    spacing: 2</span><br><span class="line">    x: 0</span><br><span class="line">    top: root.top</span><br><span class="line">    size_hint: None,None</span><br><span class="line">    size: 280, 44</span><br><span class="line"></span><br><span class="line">    LineWidthButton:</span><br><span class="line">        text: &#x27;Thin&#x27;</span><br><span class="line"></span><br><span class="line">    LineWidthButton:</span><br><span class="line">        text: &#x27;Normal&#x27;</span><br><span class="line">        state: &#x27;down&#x27;</span><br><span class="line"></span><br><span class="line">    LineWidthButton:</span><br><span class="line">        text: &#x27;Thick&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新增清空画板功能;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># !/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from kivy.app import App</span><br><span class="line">from kivy.uix.widget import Widget</span><br><span class="line">from kivy.graphics import Line, Color</span><br><span class="line">from kivy.utils import get_color_from_hex</span><br><span class="line"># 添加边框样式</span><br><span class="line">from kivy.uix.behaviors import ToggleButtonBehavior</span><br><span class="line">from kivy.uix.togglebutton import ToggleButton</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 因为已经在这边添加了ToggleButton的公共类，提取出公共属性的两个就不需要使用ToggleButton而是可以直接使用</span><br><span class="line"># FrameToggleButton即可</span><br><span class="line">class FrameToggleButton(ToggleButton):</span><br><span class="line">    &quot;&quot;&quot;当前按钮添加边框&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def do_press(self):</span><br><span class="line">        &quot;&quot;&quot;点击改变状态&quot;&quot;&quot;</span><br><span class="line">        if self.state == &#x27;normal&#x27;:</span><br><span class="line">            ToggleButtonBehavior.do_press(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DrawCanvasWidget(Widget):</span><br><span class="line">    def __init__(self, **kwargs):</span><br><span class="line">        super(DrawCanvasWidget, self).__init__(**kwargs)</span><br><span class="line">        &quot;&quot;&quot;设置画笔的默认颜色为黑色&quot;&quot;&quot;</span><br><span class="line">        self.change_color(get_color_from_hex(&#x27;#12aced&#x27;))</span><br><span class="line">        self.change_line_width()</span><br><span class="line"></span><br><span class="line">    def on_touch_down(self, touch):</span><br><span class="line">        &quot;&quot;&quot;触摸显示轨迹&quot;&quot;&quot;</span><br><span class="line">        if Widget.on_touch_down(self, touch):</span><br><span class="line">            return</span><br><span class="line">        with self.canvas:</span><br><span class="line">            touch.ud[&#x27;current_line&#x27;] = Line(points=(touch.x, touch.y), width=self.line_width)</span><br><span class="line"></span><br><span class="line">    def on_touch_move(self, touch):</span><br><span class="line">        &quot;&quot;&quot;连线&quot;&quot;&quot;</span><br><span class="line">        if &#x27;current_line&#x27; in touch.ud:</span><br><span class="line">            touch.ud[&#x27;current_line&#x27;].points += (touch.x, touch.y)</span><br><span class="line"></span><br><span class="line">    def change_color(self, new_color):</span><br><span class="line">        &quot;&quot;&quot;调色&quot;&quot;&quot;</span><br><span class="line">        self.last_color = new_color</span><br><span class="line">        self.canvas.add(Color(*new_color))</span><br><span class="line"></span><br><span class="line">    def change_line_width(self, line_width=&#x27;Normal&#x27;):</span><br><span class="line">        self.line_width = &#123;&#x27;Thin&#x27;: 1, &#x27;Normal&#x27;: 2, &#x27;Thick&#x27;: 4&#125;[line_width]</span><br><span class="line"></span><br><span class="line">    def clear_canvas(self):</span><br><span class="line">        saved = self.children[:]</span><br><span class="line">        self.clear_widgets()</span><br><span class="line">        self.canvas.clear()</span><br><span class="line">        for widget in saved:</span><br><span class="line">            self.add_widget(widget)</span><br><span class="line">        self.change_color(self.last_color)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PaintApp(App):</span><br><span class="line">    def build(self):</span><br><span class="line">        self.draw_canvas_widget = DrawCanvasWidget()</span><br><span class="line">        return self.draw_canvas_widget</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    PaintApp().run()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>#:import C kivy.utils.get_color_from_hex

&lt;BottomColorButton@FrameToggleButton&gt;:
    group: &#39;color&#39;
    background_normal: &#39;&#39;
    background_down: &#39;&#39;
    border: (1, 1, 1, 1)
    on_release: app.draw_canvas_widget.change_color(self.background_color)

&lt;LineWidthButton@FrameToggleButton&gt;:
    group: &#39;line_width&#39;
    color: C(&#39;#2c3e50&#39;)
    background_color: C(&#39;#ecf0f1&#39;)
    background_normal: &#39;&#39;
    background_down: &#39;&#39;
    border: (3, 3, 3, 3)
    on_release: app.draw_canvas_widget.change_line_width(self.text)


&lt;DrawCanvasWidget&gt;:
    canvas.before:
        Color:
            rgba: [1, 1, 1, 1]
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: &#39;horizontal&#39;
        padding: 2
        spacing: 2
        x: 0
        top: root.top
        size_hint: None,None
        size: 280, 44

        LineWidthButton:
            text: &#39;Thin&#39;

        LineWidthButton:
            text: &#39;Normal&#39;
            state: &#39;down&#39;

        LineWidthButton:
            text: &#39;Thick&#39;

        Button:
            text: &#39;Clear&#39;
            on_release: root.clear_canvas()


    BoxLayout:
        id: bottom_box
        orientation: &#39;horizontal&#39;
        padding: 2
        spacing: 2
        size: root.width, 40

        BottomColorButton:
            background_color: C(&#39;#19caad&#39;)
            state: &#39;down&#39;

        BottomColorButton:
            background_color: C(&#39;#8cc7b5&#39;)

        BottomColorButton:
            background_color: C(&#39;#a0eee1&#39;)

        BottomColorButton:
            background_color: C(&#39;#bee7e9&#39;)

        BottomColorButton:
            background_color: C(&#39;#beedc7&#39;)

        BottomColorButton:
            background_color: C(&#39;#d6d5b7&#39;)

        BottomColorButton:
            background_color: C(&#39;#d1ba74&#39;)

        BottomColorButton:
            background_color: C(&#39;#e6ceac&#39;)

        BottomColorButton:
            background_color: C(&#39;#ecad9e&#39;)

        BottomColorButton:
            background_color: C(&#39;#f4606c&#39;)

        BottomColorButton:
            background_color: C(&#39;#3498db&#39;)

        BottomColorButton:
            background_color: C(&#39;#1abc9c&#39;)

        BottomColorButton:
            background_color: C(&#39;#2ecc71&#39;)

        BottomColorButton:
            background_color: C(&#39;#f1c40f&#39;)

        BottomColorButton:
            background_color: C(&#39;#e67e22&#39;)

        BottomColorButton:
            background_color: C(&#39;#e74c3c&#39;)

        BottomColorButton:
            background_color: C(&#39;#9b59bc&#39;)

        BottomColorButton:
            background_color: C(&#39;#ecf0f1&#39;)

        BottomColorButton:
            background_color: C(&#39;#95a5a6&#39;)

        BottomColorButton:
            background_color: C(&#39;#000000&#39;)
</code></pre>
<h3 id="部分UX部件"><a href="#部分UX部件" class="headerlink" title="部分UX部件"></a>部分UX部件</h3><p>前面我们已经对Layout布局，以及Canvas 画布进行了学习，我们接下来来看看，经常使用的一些部件，这些部件是图形界面设计的重要组成部分，合理使用可以更高效的开发程序。我们先从简单部件开始。</p>
<h4 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h4><p>button常用属性</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>background_color</td>
<td>按钮的背景颜色，rgba格式，默认为灰色</td>
</tr>
<tr>
<td>text</td>
<td>按钮显示的文本</td>
</tr>
<tr>
<td>font_size</td>
<td>文本字体的大小，默认为15sp</td>
</tr>
<tr>
<td>color</td>
<td>文本字体颜色，rgba格式，默认为白色[1,1,1,1]</td>
</tr>
<tr>
<td>state</td>
<td>按钮状态，默认为“normal”，可设置成“down”</td>
</tr>
<tr>
<td>disables</td>
<td>如果为True时则禁用按钮，默认为False</td>
</tr>
<tr>
<td>background_disabled_normal</td>
<td>默认为“kivy\tools\theming\defaulttheme\button_disabled_pressed.png”</td>
</tr>
<tr>
<td>background_disabled_down</td>
<td>默认为“kivy\tools\theming\defaulttheme\button_disabled.png”</td>
</tr>
<tr>
<td>background_down</td>
<td>按下按钮时显示的图形，默认为“kivy\tools\theming\defaulttheme\button_pressed.png”</td>
</tr>
<tr>
<td>background_normal</td>
<td>未按下按钮时显示的图像，默认为“kivy\tools\theming\defaulttheme\button.png”</td>
</tr>
<tr>
<td>border</td>
<td>与background_normal 和background_down 属性一起使用，可用于自定义背景。</td>
</tr>
</tbody></table>
<h5 id="触发事件"><a href="#触发事件" class="headerlink" title="触发事件"></a>触发事件</h5><ul>
<li>on_press：按下按钮触发该事件</li>
<li>on_release: 按下按钮并释放时，触发该事件</li>
</ul>
<h4 id="Label标签"><a href="#Label标签" class="headerlink" title="Label标签"></a>Label标签</h4><p>Kivy中的Label小部件用于显示文本，目前只支持ASCII和Unicode编码字符（暂不支持中文），可以通过属性设置文本内容，字体，大小，颜色，对齐方式，换行以及标记文字等内容。</p>
<h5 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h5><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>text</td>
<td>标签显示文本大小，默认为空字符串</td>
</tr>
<tr>
<td>text_size</td>
<td>标签文本大小、默认为（None，None），表示无限制</td>
</tr>
<tr>
<td>font_name</td>
<td>要使用字体的文件名，可以是绝对路径或者resource_find解析的相对路径</td>
</tr>
<tr>
<td>font_size</td>
<td>文本字体的大小，以像素为单位，默认为15sp</td>
</tr>
<tr>
<td>bold</td>
<td>字体使用粗体，默认为False</td>
</tr>
<tr>
<td>italic</td>
<td>字体使用斜体，默认为False</td>
</tr>
<tr>
<td>color</td>
<td>字体颜色，格式为rgba，默认为白色[1,1,1,1]</td>
</tr>
<tr>
<td>halign</td>
<td>文本的水平对齐方式，默认为‘auto’，可选参数为： buttom,middle 或者 Center 和 top</td>
</tr>
<tr>
<td>markup</td>
<td>是否分割所有标记文本，默认为False</td>
</tr>
<tr>
<td>refs</td>
<td>使用[ref&#x3D;xxx]xxx[&#x2F;ref]标记部分文本，使用时需要将markup属性设置为True</td>
</tr>
<tr>
<td>underline</td>
<td>文本上添加下划线，默认为False</td>
</tr>
<tr>
<td>padding_x</td>
<td>小部件框内文本的水平填充，默认为0</td>
</tr>
<tr>
<td>padding_y</td>
<td>小部件框内文本的垂直填充，默认为0</td>
</tr>
<tr>
<td>padding</td>
<td>以（padding_x，padding_y）格式填充文字</td>
</tr>
<tr>
<td>texture</td>
<td>文本的纹理对象，属性更改时会自动呈现文本，默认为None</td>
</tr>
<tr>
<td>texture_size</td>
<td>文本纹理大小，由字体大小和文本确定</td>
</tr>
<tr>
<td>unicode_error</td>
<td>如何处理Unicode解码错误，可选参数为：“strict”, “replace”（默认）和“ignore”</td>
</tr>
<tr>
<td>strikethrough</td>
<td>在文本中添加删除线</td>
</tr>
<tr>
<td>strip</td>
<td>与python 内置函数一致，是否删除空格以及换行符，默认为False</td>
</tr>
<tr>
<td>outline_color</td>
<td>文本轮廓颜色，格式为rgba， 默认为[0,0,0]</td>
</tr>
<tr>
<td>outline_width</td>
<td>文本周围轮廓的宽度，单位为像素，默认为None表示不会渲染轮廓</td>
</tr>
<tr>
<td>max_lines</td>
<td>要使用的最大行数，默认为0，表示无限制</td>
</tr>
<tr>
<td>shorten</td>
<td>是否应该尽可能缩短文本内容，默认为False</td>
</tr>
<tr>
<td>shorten_from</td>
<td>在哪一侧缩短文本，默认为center，可选 left，right 和 center</td>
</tr>
<tr>
<td>split_str</td>
<td>当shorten 为True 时，差分字符串，默认为空字符串</td>
</tr>
<tr>
<td>is_shortened</td>
<td>是否以缩短事件的方式进行渲染，默认为False</td>
</tr>
<tr>
<td>line_height</td>
<td>文本的行高，默认为1.0</td>
</tr>
<tr>
<td>base_direction</td>
<td>文本基本方向，当halign为auto 时，会影响水平对齐，可设置参数为：None、ltr (从左到右)、rtl、weak_lte、weak_rtl</td>
</tr>
<tr>
<td>disabled_color</td>
<td>禁用小部件时文本轮廓的颜色，格式为rgb，默认为[0,0,0]</td>
</tr>
<tr>
<td>ellipsis_options</td>
<td>使用’···’缩短文本，使用时要设置markuo和shorten为True，默认为空字典{}</td>
</tr>
<tr>
<td>font_blended</td>
<td>使用混合字体，默认为True</td>
</tr>
<tr>
<td>font_context</td>
<td>字体上下文，默认为None表示该字体单独使用</td>
</tr>
<tr>
<td>font_family</td>
<td>字体系列，仅在使用font_context时使用，</td>
</tr>
<tr>
<td>font_features</td>
<td>将CSS格式的OpenType字体传给Pango ，默认为空字符。</td>
</tr>
<tr>
<td>font_hinting</td>
<td>渲染字体的提示选项，可选参数为’normal‘,’light’,’mono’和None</td>
</tr>
<tr>
<td>font_kerning</td>
<td>是否为字形渲染，启用字距调整，默认为True</td>
</tr>
<tr>
<td>mipmap</td>
<td>是否将OpenGL mipmapping应用于纹理，默认为False</td>
</tr>
</tbody></table>
<p>开启以下需要将markup打开</p>
<table>
<thead>
<tr>
<th>可用标记</th>
<th>解释</th>
<th>可用标记</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>[b][&#x2F;b]</td>
<td>加粗</td>
<td>[i][&#x2F;i]</td>
<td>斜体</td>
</tr>
<tr>
<td>[u][&#x2F;u]</td>
<td>下划线</td>
<td>[s][&#x2F;s]</td>
<td>删除线</td>
</tr>
<tr>
<td>[sub][&#x2F;sub]</td>
<td>下标</td>
<td>[sup][&#x2F;sup]</td>
<td>上标</td>
</tr>
<tr>
<td>[font&#x3D;][&#x2F;font]</td>
<td>更改字体</td>
<td>[size&#x3D;][&#x2F;size]]</td>
<td>大小</td>
</tr>
<tr>
<td>[color&#x3D;#][&#x2F;color]</td>
<td>颜色</td>
<td>[anchor&#x3D;]</td>
<td>锚点，（x,y）</td>
</tr>
<tr>
<td>[ref&#x3D;][&#x2F;ref]</td>
<td>添加一个交互式引用区，引用一个方法</td>
<td>[text_language&#x3D;&lt;&gt;][&#x2F;text_language]</td>
<td>文本语言,例： “&lt;zh_CN&gt;”</td>
</tr>
<tr>
<td>&amp;bl</td>
<td>[</td>
<td>&amp;br</td>
<td>]</td>
</tr>
<tr>
<td>&amp;amp</td>
<td>&amp;</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#:import C kivy.utils.get_color_from_hex</span><br><span class="line"></span><br><span class="line">&lt;LabelBoxLayout&gt;:</span><br><span class="line">    orientation: &#x27;vertical&#x27;</span><br><span class="line">    Button:</span><br><span class="line">        text: &#x27;Button&#x27;</span><br><span class="line">        on_press: root.on_press_btn()</span><br><span class="line">        on_release: root.on_release_btn()</span><br><span class="line"></span><br><span class="line">    Label:</span><br><span class="line">        id: lable_btn</span><br><span class="line">        text: &#x27;The first step is one of awareness. It will be hard to make a change to positive thinking without being acutely intimate with the thoughts that run through your mind. Recently, I was amazed to discover deep buried emotions from negative thoughts that I had for fewer than 10 minutes. Without awareness, I would have carried the hurt and anger inside. Awareness helped me to bring them out to the open for me to deal with.&#x27;</span><br><span class="line">        font_size: &#x27;20sp&#x27;</span><br><span class="line">        color: C(&#x27;#B0C4DE&#x27;)</span><br><span class="line">        italic: True</span><br><span class="line">        text_size: cm(15), mm(200)</span><br><span class="line">        halign: &#x27;right&#x27;</span><br><span class="line">        valign: &#x27;middle&#x27;</span><br><span class="line">        strikethrough: True</span><br><span class="line">    Label:</span><br><span class="line">        canvas.before:</span><br><span class="line">            Color:</span><br><span class="line">                rgba: C(&#x27;#DCDCDC&#x27;)</span><br><span class="line">            Rectangle:</span><br><span class="line">                pos: self.pos</span><br><span class="line">                size: self.size</span><br><span class="line">        text: &#x27;There are moments in life when [i]you miss someone [color=#&quot;4169E1&quot;]so much that you just want[/color] to pick them from your[/i] dreams and hug them for real! Dream what you want to dream;go where you want to go;be what you want to be,because you have only one life and one chance to do all the things you want to do.&#x27;</span><br><span class="line">        color: C(&#x27;#FF0000&#x27;)</span><br><span class="line">        font_size: &#x27;15sp&#x27;</span><br><span class="line">        bold: True</span><br><span class="line">        text_size: cm(10), mm(100)</span><br><span class="line">        halign: &#x27;center&#x27;</span><br><span class="line">        valign: &#x27;middle&#x27;</span><br><span class="line">        underline: True</span><br><span class="line">        line_height: 1.0</span><br><span class="line">        markup: True</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> kivy.app <span class="keyword">import</span> App</span><br><span class="line"><span class="keyword">from</span> kivy.uix.label <span class="keyword">import</span> Label</span><br><span class="line"><span class="keyword">from</span> kivy.uix.boxlayout <span class="keyword">import</span> BoxLayout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LabelBoxLayout</span>(<span class="title class_ inherited__">BoxLayout</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(LabelBoxLayout, <span class="variable language_">self</span>).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_press_btn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children[<span class="number">1</span>].strikethrough = <span class="keyword">not</span> <span class="variable language_">self</span>.children[<span class="number">1</span>].strikethrough</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_release_btn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children[<span class="number">1</span>].strikethrough = <span class="keyword">not</span> <span class="variable language_">self</span>.children[<span class="number">1</span>].strikethrough</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LabelBoxApp</span>(<span class="title class_ inherited__">App</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> LabelBoxLayout()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    LabelBoxApp().run()</span><br></pre></td></tr></table></figure>

<h5 id="触发事件-1"><a href="#触发事件-1" class="headerlink" title="触发事件"></a>触发事件</h5><p>Kivy中是使用ref 来标记触发事件的，点击ref包裹的文本，就可以触发“on_ref_press”事件。</p>
<h6 id="设置Label-标签的触发事件"><a href="#设置Label-标签的触发事件" class="headerlink" title="设置Label 标签的触发事件"></a>设置Label 标签的触发事件</h6><p>在使用ref之前，需要将markup设置为True</p>
<pre><code># !/usr/bin/env python3
# -*- coding: utf-8 -*-

from kivy.app import App
from kivy.uix.label import Label
from kivy.uix.boxlayout import BoxLayout
from kivy.utils import get_color_from_hex


class LabelBoxLayout(BoxLayout):
    def __init__(self, **kwargs):
        super(LabelBoxLayout, self).__init__(**kwargs)
        strtext = &#39;Awareness [color=#00FF00][ref=label][i]helped me[/i][/ref][/color] to [b]bring[/b] [s]them out[/s] to the open for me to deal with.&#39;
        label_ref = Label(font_size=&#39;25sp&#39;,text=strtext, markup=True,
                          color=get_color_from_hex(&#39;#F0F8FF&#39;))
        label_ref.bind(on_ref_press=self.on_press_btn_label_ref)
        self.add_widget(label_ref)

    def on_press_btn(self):
        self.children[1].strikethrough = not self.children[1].strikethrough

    def on_release_btn(self):
        self.children[1].strikethrough = not self.children[1].strikethrough

    def on_press_btn_label_ref(self, *args):
        self.children[0].strikethrough = not self.children[0].strikethrough


class LabelBoxApp(App):
    def build(self):
        return LabelBoxLayout()


if __name__ == &#39;__main__&#39;:
    LabelBoxApp().run()
</code></pre>
<!---->

<pre><code>#:import C kivy.utils.get_color_from_hex

&lt;LabelBoxLayout&gt;:
    orientation: &#39;vertical&#39;
    Button:
        text: &#39;Button&#39;
        on_press: root.on_press_btn()
        on_release: root.on_release_btn()

    Label:
        id: lable_btn
        text: &#39;The [ref=lable]first step[/ref] is one of awareness. It will be hard to make a change to positive thinking without being acutely intimate with the thoughts that run through your mind. Recently, I was amazed to discover deep buried emotions from negative thoughts that I had for fewer than 10 minutes. Without awareness, I would have carried the hurt and anger inside. Awareness helped me to bring them out to the open for me to deal with.&#39;
        font_size: &#39;20sp&#39;
        color: C(&#39;#B0C4DE&#39;)
        italic: True
        text_size: cm(15), mm(200)
        halign: &#39;right&#39;
        valign: &#39;middle&#39;
        on_ref_press:
            print(&#39;Click on_ref_press&#39;)
            root.on_release_btn()
        strikethrough: True
        markup: True
    Label:
        canvas.before:
            Color:
                rgba: C(&#39;#DCDCDC&#39;)
            Rectangle:
                pos: self.pos
                size: self.size
        text: &#39;There are moments in life when [i]you miss someone [color=#&quot;4169E1&quot;]so much that you just want[/color] to pick them from your[/i] dreams and hug them for real! Dream what you want to dream;go where you want to go;be what you want to be,because you have only one life and one chance to do all the things you want to do.&#39;
        color: C(&#39;#FF0000&#39;)
        font_size: &#39;15sp&#39;
        bold: True
        text_size: cm(10), mm(100)
        halign: &#39;center&#39;
        valign: &#39;middle&#39;
        underline: True
        line_height: 1.0
        markup: True
</code></pre>
<h4 id="单位介绍"><a href="#单位介绍" class="headerlink" title="单位介绍"></a>单位介绍</h4><p>px、dp和sp，这三个单位的区别在于，它们的定义各不相同：</p>
<ul>
<li>px：指像素，是指基本原色素及其灰度的基本编码,是Pixel的缩写。像素是指基本原色素及其灰度的基本编码，由 Picture（图像）和 Element（元素）这两个单词的字母所组成的。当图片尺寸以像素为单位时，需要指定其固定的分辨率，才能将图片尺寸与现实中的实际尺寸相转换。<br>例如：大多数网页制作常用图片分辨率为72，即每英寸像素为72，1英寸等于2.54厘米。</li>
<li>dp：安卓开发时的长度单位,Density-independent pixel，是安卓开发用的长度单位，1dp表示在屏幕像素点密度为160ppi时1px长度。。</li>
<li>sp：与缩放无关的抽象像素，是字体单位.scale-independent pixel，安卓开发用的字体大小单位。一般情况下可认为sp&#x3D;dp。</li>
</ul>
<h4 id="Image图片"><a href="#Image图片" class="headerlink" title="Image图片"></a>Image图片</h4><p>使用Image控件来显示图片，可以通过size和pos来设置属性和设置大小和位置，通过source属性来指定图片的相对路径，此外，如果图片大小过大的时候，为了防止卡顿，可以使用异步的方式加载，这我们前面在学习的时候，咱们有试过，使用异步加载图片。</p>
<p>我们先来看看Image有哪些属性。</p>
<h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><table>
<thead>
<tr>
<th>属性</th>
<th>属性</th>
</tr>
</thead>
<tbody><tr>
<td>source</td>
<td>图片的文件名和路径</td>
</tr>
<tr>
<td>texture</td>
<td>图像的纹理对象，默认为None</td>
</tr>
<tr>
<td>color</td>
<td>图像颜色，格式为rgba，默认为[1,1,1,1]</td>
</tr>
<tr>
<td>texture_size</td>
<td>图像的纹理大小</td>
</tr>
<tr>
<td>allow_stretch</td>
<td>是否放打图像到边框，默认为False</td>
</tr>
<tr>
<td>anim_delay</td>
<td>动画延迟，默认为0.25秒 （4fps），若设置为-1，则停止</td>
</tr>
<tr>
<td>anim_loop</td>
<td>循环播放的次数，默认为0</td>
</tr>
<tr>
<td>image_ratio</td>
<td>图片比例</td>
</tr>
<tr>
<td>keep_data</td>
<td>是否存储原始图像数据，经常用在基于像素的碰撞检测，默认为False</td>
</tr>
<tr>
<td>keep_ratio</td>
<td>是否以忽略图像纵横比的 方式放大图像以适合图像框，默认为True</td>
</tr>
<tr>
<td>mipmap</td>
<td>是否要将OpenGL mipmapping 应用于纹理，默认为False</td>
</tr>
<tr>
<td>nocache</td>
<td>是否不将图像添加到内部缓存种，默认为False 表示添加到缓存中</td>
</tr>
<tr>
<td>norm_image_size</td>
<td>以保留比例的方式标准化图像大小，只读属性，不可更改</td>
</tr>
<tr>
<td>reload()</td>
<td>重新加载图像</td>
</tr>
</tbody></table>
<pre><code># !/usr/bin/env python3
# -*- coding: utf-8 -*-

from kivy.app import App
from kivy.uix.boxlayout import BoxLayout


class ImageBoxLayout(BoxLayout):
    def __init__(self, **kwargs):
        super(ImageBoxLayout, self).__init__(**kwargs)


class ImageBoxApp(App):
    def build(self):
        return ImageBoxLayout()


if __name__ == &#39;__main__&#39;:
    ImageBoxApp().run()
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;ImageBoxLayout&gt;:</span><br><span class="line">    canvas:</span><br><span class="line">        Color:</span><br><span class="line">            rgba:[1,1,1,1]</span><br><span class="line">        Rectangle:</span><br><span class="line">            size:self.width+20, self.height+20</span><br><span class="line">            pos: self.x-10,self.y-10</span><br><span class="line">            source:&#x27;UxParts.jpg&#x27;</span><br><span class="line"></span><br><span class="line">    AsyncImage:</span><br><span class="line">        source:&#x27;https://blogcdn.sea-whales.cn/blog/typecho/17.jpg&#x27;</span><br><span class="line">        size_hint_y: None</span><br><span class="line">        width: 300</span><br><span class="line">        allow_stretch: True   # 自适应</span><br><span class="line">    </span><br><span class="line">    Image:</span><br><span class="line">        source:&#x27;https://blogcdn.sea-whales.cn/blog/typecho/17.jpg&#x27;</span><br><span class="line">        size_hint_y: None</span><br><span class="line">        width: 300</span><br><span class="line">        allow_stretch: True</span><br></pre></td></tr></table></figure>

<h4 id="TextInput-输入框"><a href="#TextInput-输入框" class="headerlink" title="TextInput 输入框"></a>TextInput 输入框</h4><p>先来看看有哪些属性，在Kivy中，为了方便输入值的样式，Kivy 提供了大量的属性。接下来我们来看看有哪些：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>text</td>
<td>文本内容</td>
</tr>
<tr>
<td>text_language</td>
<td>文本语言，例如： zh_cn，en_us，fr 和 ja</td>
</tr>
<tr>
<td>halign</td>
<td>文本的水平对齐方式，可以设置为auto、left、center和right等属性</td>
</tr>
<tr>
<td>multiline</td>
<td>是否显示多行文本，默认属性为True</td>
</tr>
<tr>
<td>allow_copy</td>
<td>是否允许赋值文本，默认为True</td>
</tr>
<tr>
<td>auto_indent</td>
<td>自动缩进，多行文字，默认属性为False</td>
</tr>
<tr>
<td>font_size</td>
<td>文本的字体大小，以像素为单位。默认为15sp</td>
</tr>
<tr>
<td>foreground_color</td>
<td>前景色，格式是rgba 默认为[0,0,0,1]</td>
</tr>
<tr>
<td>minimum_height</td>
<td>文本框内容的最小高度</td>
</tr>
<tr>
<td>password</td>
<td>是否用password_mask 替换显示密码，默认为False</td>
</tr>
<tr>
<td>password_mask</td>
<td>当password为True时，默认以“*”替换显示密码</td>
</tr>
<tr>
<td>readonly</td>
<td>是否将文本框属性设为只读，默认为Fasle</td>
</tr>
<tr>
<td>background_color</td>
<td>背景颜色，格式为rgba，默认为白色[1,1,1,1]</td>
</tr>
<tr>
<td>padding_x</td>
<td>文本水平填充，格式为[padding_left, padding_right] 或 [padding_horizontal],默认为[0,0]</td>
</tr>
<tr>
<td>padding_y</td>
<td>文本垂直填充，格式为 [padding_top, padding_bottom] 或 [padding_vertical],默认为[0,0]</td>
</tr>
<tr>
<td>padding</td>
<td>文本填充，格式为[padding_left, padding_top, padding_right, padding_bottom]或者[padding_horizontal，padding_vertical]，默认属性为[6,6,6,6]</td>
</tr>
<tr>
<td>hint_text</td>
<td>提示文本，默认为空字符串</td>
</tr>
<tr>
<td>hint_text_color</td>
<td>提示文本的当前颜色，格式是rgba，默认为[.5,.5,.5,1]</td>
</tr>
<tr>
<td>input_filter</td>
<td>过滤输入，默认为None</td>
</tr>
<tr>
<td>paste()</td>
<td>插入剪贴板内容到当前光标位置</td>
</tr>
<tr>
<td>write_tab</td>
<td>使用Tap键将移到下一个小部件，否则进入文本框，默认为True</td>
</tr>
<tr>
<td>background_active</td>
<td>默认属性为textinput_active.png</td>
</tr>
<tr>
<td>background_disabled_normal</td>
<td>禁用Textinput时的背景图像，默认为textinput_disabled.png</td>
</tr>
<tr>
<td>handle_image_left</td>
<td>待处理的文本框左侧显示的图像</td>
</tr>
<tr>
<td>background_normal</td>
<td>失去焦点时显示的图像</td>
</tr>
<tr>
<td>handle_image_middle</td>
<td>待处理文本框中间显示图像</td>
</tr>
<tr>
<td>handle_image_right</td>
<td>待处理文本框右侧显示图像</td>
</tr>
<tr>
<td>replace_crlf</td>
<td>用LF自动替换CRLF 换行</td>
</tr>
<tr>
<td>select_all()</td>
<td>选中文本框显示的所有文本</td>
</tr>
<tr>
<td>selection_color</td>
<td>所选内容的当前颜色，格式为rgba</td>
</tr>
<tr>
<td>selection_from</td>
<td>所选开始光标索引，为只读 默认为None</td>
</tr>
<tr>
<td>selection_to</td>
<td>所选结束光标，默认为None 为只读</td>
</tr>
<tr>
<td>selection_text</td>
<td>当前选择内容，默认为空字符串，为只读</td>
</tr>
<tr>
<td>suggestion_text</td>
<td>当前行的末尾显示建议文本</td>
</tr>
<tr>
<td>tab_widtg</td>
<td>将TAB键替换指定数量的空格，默认为4个空格。</td>
</tr>
<tr>
<td>seletc_text(start,end)</td>
<td>选中文本框显示部分的内容。</td>
</tr>
<tr>
<td>base_direction</td>
<td>文本的基本方向，默认为None ，可设置为ltr,rtl,weak_ltr,weak_rtl</td>
</tr>
<tr>
<td>border</td>
<td>边框，默认属性为（4，4，4，4）</td>
</tr>
<tr>
<td>cancel_selection()</td>
<td>取消当前的选择。</td>
</tr>
<tr>
<td>use_bubble</td>
<td>是否使用剪切，复制、黏贴气泡，在移动设备默认为True，其他默认为False</td>
</tr>
<tr>
<td>use_handles</td>
<td>是否显示选择指示，在移动设备默认为True，其他默认为false</td>
</tr>
<tr>
<td>copy(date&#x3D;’’)</td>
<td>将提供的值复制到剪贴板中</td>
</tr>
<tr>
<td>cursor</td>
<td>当前光标位置</td>
</tr>
<tr>
<td>cursor_blink</td>
<td>光标是否闪烁，默认为True</td>
</tr>
<tr>
<td>cursor_col</td>
<td>光标的当前列  只读</td>
</tr>
<tr>
<td>cursor_row</td>
<td>光标当前行  只读</td>
</tr>
<tr>
<td>cursor_color</td>
<td>光标的当前颜色，rgba格式默认为[1,0,0,1]</td>
</tr>
<tr>
<td>cursor_index(cursor&#x3D;None)</td>
<td>返回文本&#x2F;值中的光标索引</td>
</tr>
<tr>
<td>cursor_offset()</td>
<td>获取当前行 光标偏移量</td>
</tr>
<tr>
<td>cursor_width</td>
<td>光标当前宽度，默认为”1 sp“</td>
</tr>
<tr>
<td>cursor_pos</td>
<td>光标当前位置，以（x,y）为单位只读</td>
</tr>
<tr>
<td>cut()</td>
<td>将当前选择剪切到剪贴板</td>
</tr>
<tr>
<td>keyboard_suggestions</td>
<td>在键盘上方是否提供建议输入，默认为True，设置input_type属性后才会生效</td>
</tr>
<tr>
<td>line_height</td>
<td>计算一行文本最小高度，为只读属性</td>
</tr>
<tr>
<td>line_spacing</td>
<td>线条之间的空间。默认为0</td>
</tr>
<tr>
<td>on_double_tap()</td>
<td>双击文本框触发该事件</td>
</tr>
<tr>
<td>on_triple_tap()</td>
<td>三击文本框触发该事件</td>
</tr>
<tr>
<td>on_quad_touch()</td>
<td>在文本框内部四指触摸触发事件</td>
</tr>
<tr>
<td>do_redo()</td>
<td>重新执行</td>
</tr>
</tbody></table>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/1604330648/">
                Linux多线程下载
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-07-14</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Linux多线程下载"><a href="#Linux多线程下载" class="headerlink" title="Linux多线程下载"></a>Linux多线程下载</h1><p>有时候我们在下载一个较大的东西上传服务器的时候，有一种操作是先使用本地电脑下载，然后上传到服务器，或者直接使用服务器上的wget进行安装，但是使用本地下载然后上传的话，如果受到本地网络或者服务器的限制，要么可能下载速度慢或者上传速度慢，而且可能会出现等待时间过长的情况，那如果我们使用linux服务器上比较常见见的下载工具curl和wget，但是两者都不支持多线程， 断点续传的作用不见得能发挥到最大。给大家介绍两款linux中多线程下载工具<code>axel</code>和<code>aria2c</code>，开启多线程疯狂下载。</p>
<p>我们先来介绍下<code>axel</code></p>
<h2 id="axel"><a href="#axel" class="headerlink" title="axel"></a>axel</h2><p>我们这边以Centos7系统为例，其他系统类似，只要使用对应的安装命令安装正确的包，就可以使用了。</p>
<h3 id="CentOS-7安装Axel："><a href="#CentOS-7安装Axel：" class="headerlink" title="CentOS 7安装Axel："></a>CentOS 7安装Axel：</h3><p>目前yum官方源上没有Axel，我们无法通过yum直接进行安装，但是我们可以通过安装epel第三方源然后后yum安装axel下载工具。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install axel</span><br></pre></td></tr></table></figure>

<p>大家也可以选择使用以下网址将rpm包下载后将包包上传，然后进行手动安装。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://pkgs.org/download/axel</span><br></pre></td></tr></table></figure>

<p>然后使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh 包名字（本地包位置以及名字）</span><br><span class="line">或者</span><br><span class="line">rpm -Uvh 包连接（远程rpm包，命令会自动下载后安装）</span><br></pre></td></tr></table></figure>

<h2 id="CentOS-6安装Axel："><a href="#CentOS-6安装Axel：" class="headerlink" title="CentOS 6安装Axel："></a>CentOS 6安装Axel：</h2><h4 id="32位CentOS-6执行下面命令："><a href="#32位CentOS-6执行下面命令：" class="headerlink" title="32位CentOS 6执行下面命令："></a>32位CentOS 6执行下面命令：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -c http://mirrors.sohu.com/dag/redhat/el6/en/i386/rpmforge/RPMS/axel-2.4-1.el6.rf.i686.rpm</span><br><span class="line">rpm -ivh axel-2.4-1.el6.rf.i686.rpm</span><br></pre></td></tr></table></figure>

<h4 id="64位CentOS-6执行下面命令："><a href="#64位CentOS-6执行下面命令：" class="headerlink" title="64位CentOS 6执行下面命令："></a>64位CentOS 6执行下面命令：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -c http://mirrors.sohu.com/dag/redhat/el6/en/x86_64/rpmforge/RPMS/axel-2.4-1.el6.rf.x86_64.rpm</span><br><span class="line">rpm -ivh axel-2.4-1.el6.rf.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h3 id="Debian-Ubuntu安装Axel："><a href="#Debian-Ubuntu安装Axel：" class="headerlink" title="Debian&#x2F;Ubuntu安装Axel："></a>Debian&#x2F;Ubuntu安装Axel：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install axel</span><br></pre></td></tr></table></figure>

<h3 id="Fedora安装Axel"><a href="#Fedora安装Axel" class="headerlink" title="Fedora安装Axel"></a>Fedora安装Axel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install axel</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>简略使用.”-n”线程数、”-o”下载保存目录、”-a”简略下载条。我们以下载一个GITHUB上的Odoo为例,这个包大概149MB，我正常下载速度在30k左右。</p>
<p><img src="https://blogcdn.sea-whales.cn/blog/typecho/image-20210915133508036.png" alt="image-20210915133508036"></p>
<p>用axel开10个下载:</p>
<p><img src="https://blogcdn.sea-whales.cn/blog/typecho/image-20210915142502988.png" alt="image-20210915142502988"></p>
<p><img src="https://blogcdn.sea-whales.cn/blog/typecho/image-20210915142728672.png" alt="image-20210915142728672"></p>
<p>本想使用相同的下载，但是由于我系统安装的axel过低，下载Https的时候一直出现以下情况：</p>
<p><img src="https://blogcdn.sea-whales.cn/blog/typecho/image-20210915142803607.png" alt="image-20210915142803607"></p>
<p>我看了下资料好像是我安装的<code>axel</code>版本较低，我尝试安装更高版本的，但是由于都是第三方包，且包对不上版本，所以我就拿另一个作为比对，我们可以看到，单个线程下载的速度可以到达3万Kb左右。<strong>而且如果下载过程中下载中断可以再执行下载命令即可恢复上次的下载进度。</strong></p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">--max-speed=x , -s x 最高速度x </span><br><span class="line">--num-connections=x , -n x 连接数x </span><br><span class="line">--output=f , -o f 下载为本地文件f </span><br><span class="line">--search[=x] , -S [x] 搜索镜像 </span><br><span class="line">--header=x , -H x 添加头文件字符串x（指定 HTTP header） </span><br><span class="line">--user-agent=x , -U x 设置用户代理（指定 HTTP user agent） </span><br><span class="line">--no-proxy ， -N 不使用代理服务器 </span><br><span class="line">--quiet ， -q 静默模式 </span><br><span class="line">--verbose ，-v 更多状态信息 </span><br><span class="line">--alternate ， -a Alternate progress indicator </span><br><span class="line">--<span class="built_in">help</span> ，-h 帮助 </span><br><span class="line">--version ，-V 版本信息</span><br></pre></td></tr></table></figure>

<h2 id="aria2c"><a href="#aria2c" class="headerlink" title="aria2c"></a>aria2c</h2><p>aria2就更强大了，他提供了Windows、Mac和Linux三个版本的，在Windows上实现多线程下载。使用命令.&#x2F;aria2c –v，查看Enabled Feature。如下图所示，支持BT，GZip, HTTPS， Medssage Digest下载。aria2是一个轻量级的多协议多源命令行下载实用程序。可以通过内置的JSON-RPC和XML-RPC接口操作aria2。重点圈出来HTTPS，是因为我想下载的一些文件是基于HTTPS。</p>
<p><img src="https://blogcdn.sea-whales.cn/blog/typecho/image-20210915143730187.png" alt="image-20210915143730187"></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://github.com/aria2/aria2/releases">https://github.com/aria2/aria2/releases</a><br>根据平台选择相应的版本就可以了</p>
<h3 id="下载相关配置"><a href="#下载相关配置" class="headerlink" title="下载相关配置"></a>下载相关配置</h3><p>进入 <code>mkdir ~/.aria2</code></p>
<pre><code>最大同时下载任务数, 运行时可修改, 默认:5
max-concurrent-downloads=5

同一服务器连接数, 添加时可指定, 默认:1
max-connection-per-server=15

最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M
假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载
min-split-size=10M

单个任务最大线程数, 添加时可指定, 默认:5
split=5

整体下载速度限制, 运行时可修改, 默认:0
#max-overall-download-limit=0

单个任务下载速度限制, 默认:0
#max-download-limit=0

整体上传速度限制, 运行时可修改, 默认:0
max-overall-upload-limit=20kb

单个任务上传速度限制, 默认:0
max-upload-limit=5kb

禁用IPv6, 默认:false
disable-ipv6=true

禁用https证书检查
check-certificate=false
#运行覆盖已存在文件
allow-overwrite=true
#自动重命名
auto-file-renaming

进度保存相关
从会话文件中读取下载任务
input-file=/etc/aria2/aria2.session

在Aria2退出时保存错误/未完成的下载任务到会话文件
save-session=/etc/aria2/aria2.session

定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0
save-session-interval=30

RPC相关设置
启用RPC, 默认:false
enable-rpc=true

允许所有来源, 默认:false
rpc-allow-origin-all=true

允许非外部访问, 默认:false
rpc-listen-all=true

事件轮询方式, 取值:[epoll, kqueue, port, poll, select], 不同系统默认值不同
#event-poll=select

RPC监听端口, 端口被占用时可以修改, 默认:6800
rpc-listen-port=6800

保存上传的种子文件
rpc-save-upload-metadata=false

BT/PT下载相关
当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:true
#follow-torrent=true

BT监听端口, 当端口被屏蔽时使用, 默认:6881-6999
listen-port=51413

单个种子最大连接数, 默认:55
#bt-max-peers=55

打开DHT功能, PT需要禁用, 默认:true
enable-dht=true

打开IPv6 DHT功能, PT需要禁用
enable-dht6=false

DHT网络监听端口, 默认:6881-6999
#dht-listen-port=6881-6999

本地节点查找, PT需要禁用, 默认:false
bt-enable-lpd=true

种子交换, PT需要禁用, 默认:true
enable-peer-exchange=true

每个种子限速, 对少种的PT很有用, 默认:50K
#bt-request-peer-speed-limit=50K

客户端伪装, PT需要
peer-id-prefix=-UT341-
user-agent=uTorrent/341(109279400)(30888)

当种子的分享率达到这个数时, 自动停止做种, 0为一直做种, 默认:1.0
seed-ratio=1.0

强制保存会话, 话即使任务已经完成, 默认:false
较新的版本开启后会在任务完成后依然保留.aria2文件
#force-save=false

BT校验相关, 默认:true
#bt-hash-check-seed=true

继续之前的BT任务时, 无需再次校验, 默认:false
bt-seed-unverified=true

保存磁力链接元数据为种子文件(.torrent文件), 默认:false
#bt-save-metadata=false
#仅下载种子文件
bt-metadata-only=true
#通过网上的种子文件下载，种子保存在内存
follow-torrent=mem
</code></pre>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="一般下载"><a href="#一般下载" class="headerlink" title="一般下载"></a>一般下载</h4><p>使用aria2 下载文件，只需在命令后附加地址即可如：</p>
<pre><code>aria2c http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.6.tar.bz2
</code></pre>
<h4 id="分段下载"><a href="#分段下载" class="headerlink" title="分段下载"></a>分段下载</h4><p>利用 aria2的分段下载功能可以加快文件的下载速度，对于下载大文件时特别有用。为了使用aria2的分段下载功能，你需要在命令中指定s选项</p>
<pre><code>aria2c -s 2 http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.6.tar.bz2
</code></pre>
<p>这将使用2个连接来下载该文件。s后面的参数值介于1~5之间，你可以根据实际情况选择。</p>
<h4 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h4><p>在命令中使用c选项可以断点续传文件。</p>
<pre><code>aria2c -c http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.6.tar.bz2
</code></pre>
<h4 id="下载-torrent-文件"><a href="#下载-torrent-文件" class="headerlink" title="下载 torrent 文件"></a>下载 torrent 文件</h4><p>你也可以使用 aria2 下载BitTorrent文件如：</p>
<pre><code>aria2c -0 gutsy.torrent http://cdimage.ubuntu.com/daily-live/current/gutsy-desktop-i386.iso.torrent
</code></pre>
<h4 id="文件读取连接下载"><a href="#文件读取连接下载" class="headerlink" title="文件读取连接下载"></a>文件读取连接下载</h4><p>从 files.txt 中获取下载链接进行下载， files.txt 中可以包含多个链接如：</p>
<pre><code>aria2c -i files.txt
</code></pre>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/742726656/">
                字符串匹配的KMP算法
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-07-14</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/3965341360/">
                记一次RedHat文件夹访问权限设定
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-07-14</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>家里有闲置的电脑，于是我给他装上了RedHat 9.4，准备将一些资料存到上面，于是我装Samba服务将磁盘共享出来，又不想直接使用root权限进行登录，于是做了一个其他账户;<br>这一系列做完后，又将Hexo迁移到Linux上，于是我在Samba共享的磁盘下面给出了一个文件夹用于hexo，比较Windows写MD比较顺手嘛。本着不同账户管理的思想，于是我又建了一个Hexo账户,用于正对Hexo的部署和生成，此时就发现不同账户生成的文件夹和文件,归属权和操作权在不同终端或者Windows资源管理器上没权限操作,于是我就给文件夹指定了特地账户可以完全访问的权限。</p>
<h2 id="开始操作"><a href="#开始操作" class="headerlink" title="开始操作"></a>开始操作</h2><p>为了实现在 Red Hat 系统上自动给指定文件夹及其所有子文件夹和文件设置两个特定账户的完全访问权限（读、写、执行），可以使用 bash 脚本结合 <code>chown</code>、<code>chmod</code> 和 <code>setfacl</code> 命令。<br>注意，<code>chown</code> 命令用于改变文件或目录的所有者，而完全访问权限（读、写、执行）通常通过调整权限（使用 <code>chmod</code>）和访问控制列表（使用 <code>setfacl</code>）来实现。<br>以下是三个命令的一些基本用法;</p>
<h3 id="chown-（改变某个文件或目录的所有者和所属的组）"><a href="#chown-（改变某个文件或目录的所有者和所属的组）" class="headerlink" title="chown （改变某个文件或目录的所有者和所属的组）"></a>chown （改变某个文件或目录的所有者和所属的组）</h3><p><code>chown</code> （<code>change owner</code>），其功能是命令改变某个文件或目录的所有者和所属的组，该命令可以向某个用户授权，使该用户变成指定文件的所有者或者改变文件所属的组。</p>
<h3 id="chmod-（变更文件或目录的权限）"><a href="#chmod-（变更文件或目录的权限）" class="headerlink" title="chmod （变更文件或目录的权限）"></a>chmod （变更文件或目录的权限）</h3><p><code>chmod</code>（<code>change mode</code>），其功能是改变文件或目录权限的命令。默认只有文件的所有者和管理员可以设置文件权限，普通用户只能管理自己文件的权限属性。</p>
<h3 id="setfacl-（精确的控制文件权限的分配）"><a href="#setfacl-（精确的控制文件权限的分配）" class="headerlink" title="setfacl （精确的控制文件权限的分配）"></a>setfacl （精确的控制文件权限的分配）</h3><p><code>setfacl</code>（<code>set file access control list</code> 即”设置文件访问控制列表“） 其功能是可以更加精确的控制文件权限的分配，比如让某一个用户对某一个文件具有某种权限。</p>
<p>总的来说<code>setfacl</code>命令可以用来细分<code>linux</code>下的文件权限。<br>而<code>chmod</code>命令可以把文件权限分为u,g,o三个组，而<code>setfacl</code>可以对每一个文件或目录设置更精确的文件权限。<br>比如：让某一个用户对某一个文件具有某种权限。<br>这种独立于传统的u,g,o的rwx权限之外的具体权限设置叫<code>ACL</code>（<code>Access Control List</code>）</p>
<p>ACL可以针对单一用户、单一文件或目录来进行r,w,x的权限控制，对于需要特殊权限的使用状况有一定帮助。<br>如，某一个文件，不让单一的某个用户访问。<br>使用<code>setfacl</code>前，要先确保你的系统支持 ACL（访问控制列表），这可以通过运行 <code>getfacl</code> 命令来检查。如果系统提示找不到该命令，你可能需要安装 <code>acl</code> 包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hexo@sea-whales seawhales]$ getfacl</span><br><span class="line">Usage: getfacl [-aceEsRLPtpndvh] file ...</span><br><span class="line">Try `getfacl --<span class="built_in">help</span><span class="string">&#x27; for more information.</span></span><br></pre></td></tr></table></figure>
<p>如果不支持可以执行以下命令,我这边是已经安装了所以没有过程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# yum install acl -y</span><br><span class="line">正在更新 Subscription Management 软件仓库。</span><br><span class="line">上次元数据过期检查：0:59:08 前，执行于 2024年07月14日 星期日 20时01分07秒。</span><br><span class="line">软件包 acl-2.3.1-4.el9.x86_64 已安装。</span><br><span class="line">依赖关系解决。</span><br><span class="line">无需任何处理。</span><br><span class="line">完毕！</span><br><span class="line">[root@sea-whales ~]#</span><br></pre></td></tr></table></figure>

<h2 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -R -m u:<span class="string">&quot;hexo&quot;</span>:rwx <span class="string">&quot;/home/hexo&quot;</span></span><br></pre></td></tr></table></figure>
<p>于是我就想如果有很多用户那就得执行很多一样的命令于是我就把他写成脚本，假设想让 <code>/path/to/directory</code> 目录及其所有子目录和文件对 <code>user1</code> 和 <code>user2</code> 拥有完全访问权限（即读、写、执行）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定目标目录</span></span><br><span class="line">TARGET_DIR=<span class="string">&quot;/path/to/directory&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定需要添加权限的用户</span></span><br><span class="line">USERS=(<span class="string">&quot;user1&quot;</span> <span class="string">&quot;user2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置目录和文件的初始权限</span></span><br><span class="line"><span class="comment"># 例如，给所有者读写执行权限，给组和其他用户读执行权限</span></span><br><span class="line"><span class="comment"># 注意：你可能需要根据实际情况调整这些权限</span></span><br><span class="line"><span class="built_in">chmod</span> -R 755 <span class="string">&quot;<span class="variable">$TARGET_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历用户列表，为每个用户设置ACL</span></span><br><span class="line"><span class="keyword">for</span> USER <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;USERS[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 设置用户对目录的完全控制（rwx）</span></span><br><span class="line">    <span class="comment"># 注意：对于目录，通常需要执行权限来进入</span></span><br><span class="line">    setfacl -R -m u:<span class="string">&quot;<span class="variable">$USER</span>&quot;</span>:rwx <span class="string">&quot;<span class="variable">$TARGET_DIR</span>&quot;</span></span><br><span class="line">    <span class="comment"># 如果需要，你还可以设置默认ACL，以便新创建的文件和目录也继承这些权限</span></span><br><span class="line">    setfacl -R -d -m u:<span class="string">&quot;<span class="variable">$USER</span>&quot;</span>:rwx <span class="string">&quot;<span class="variable">$TARGET_DIR</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;权限设置完成，<span class="variable">$TARGET_DIR</span> 目录及其所有子目录和文件现在对 <span class="variable">$&#123;USERS[*]&#125;</span> 拥有完全访问权限。&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ol>
<li>脚本中的 <code>chmod -R 755 &quot;$TARGET_DIR&quot;</code> 设置了目录和文件的初始权限。你可能需要根据实际情况调整这些权限。</li>
<li><code>setfacl -R -m u:&quot;$USER&quot;:rwx &quot;$TARGET_DIR&quot;</code> 命令给每个用户设置了对目录和文件的完全访问权限（读、写、执行）。<code>-R</code> 选项表示递归地应用到所有子目录和文件。</li>
<li><code>setfacl -R -d -m u:&quot;$USER&quot;:rwx &quot;$TARGET_DIR&quot;</code> 命令设置了默认 ACL，这意呀着在 <code>$TARGET_DIR</code> 下新创建的文件和目录将自动继承这些 ACL 规则。</li>
<li>请确保 <code>$TARGET_DIR</code> 和 <code>USERS</code> 数组中的值根据你的需求进行了正确的设置。</li>
<li>运行此脚本可能需要 root 权限，因为修改文件系统的权限和 ACL 通常需要超级用户权限。</li>
</ol>
<p>保存此脚本到一个文件中，例如 <code>set_directory_permissions.sh</code>，然后通过运行 <code>chmod +x set_directory_permissions.sh</code> 使其可执行，最后以 root 用户身份执行它：<code>sudo ./set_directory_permissions.sh</code>。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/1856186068/">
                MongoDB安装记录和错误解决
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-07-14</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>我使用的是RedHat 9.4 安装Mongodb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# <span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line">Red Hat Enterprise Linux release 9.4 (Plow)</span><br></pre></td></tr></table></figure>
<h2 id="1-MongoDB安装"><a href="#1-MongoDB安装" class="headerlink" title="1. MongoDB安装"></a>1. MongoDB安装</h2><p>Mongodb有以下几种安装方式：</p>
<ol>
<li>使用yum安装</li>
<li>手动下载并安装</li>
<li>使用docker安装</li>
</ol>
<h3 id="1-1-使用yum安装"><a href="#1-1-使用yum安装" class="headerlink" title="1.1 使用yum安装"></a>1.1 使用yum安装</h3><p>一般情况推荐YUM安装，因为它可以确保您安装的是官方支持的最新版本，并且方便进行后续的更新和维护。</p>
<h4 id="添加MongoDB官方YUM仓库"><a href="#添加MongoDB官方YUM仓库" class="headerlink" title="添加MongoDB官方YUM仓库"></a>添加MongoDB官方YUM仓库</h4><p>首先，需要创建一个新的YUM仓库配置文件，例如<code>/etc/yum.repos.d/mongodb-org-7.0.repo</code>（注意版本号可能根据MongoDB的最新版本而变化）。<br>在该文件中，添加MongoDB的官方仓库信息，包括仓库名称、基础URL、GPG密钥等。<br>我使用的是<code>mongodb-org-7.0</code>，所以我的配置文件如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# cat /etc/yum.repos.d/mongodb-org-7.0.repo</span><br><span class="line">[mongodb-org-7.0]</span><br><span class="line">name=MongoDB Repository</span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/9/mongodb-org/7.0/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://pgp.mongodb.com/server-7.0.asc</span><br></pre></td></tr></table></figure>
<p>注:可以将上面的版本号替换为希望安装的MongoDB版本号</p>
<ol>
<li>安装依赖包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# yum install -y mongodb-org</span><br><span class="line">[root@sea-whales ~]# <span class="built_in">sudo</span> yum install -y mongodb-org</span><br><span class="line">正在更新 Subscription Management 软件仓库。</span><br><span class="line">上次元数据过期检查：4:10:05 前，执行于 2024年07月14日 星期日 07时04分06秒。</span><br><span class="line">依赖关系解决。</span><br><span class="line">=================================================================================================================================================================================================================</span><br><span class="line"> 软件包                                                            架构                                    版本                                           仓库                                              大小</span><br><span class="line">=================================================================================================================================================================================================================</span><br><span class="line">安装:</span><br><span class="line"> mongodb-org                                                       x86_64                                  7.0.12-1.el9                                   mongodb-org-7.0                                  9.3 k</span><br><span class="line">安装依赖关系:</span><br><span class="line"> mongodb-database-tools                                            x86_64                                  100.9.5-1                                      mongodb-org-7.0                                   28 M</span><br><span class="line"> mongodb-mongosh                                                   x86_64                                  2.2.12-1.el8                                   mongodb-org-7.0                                   56 M</span><br><span class="line"> mongodb-org-database                                              x86_64                                  7.0.12-1.el9                                   mongodb-org-7.0                                  9.4 k</span><br><span class="line"> mongodb-org-database-tools-extra                                  x86_64                                  7.0.12-1.el9                                   mongodb-org-7.0                                   14 k</span><br><span class="line"> mongodb-org-mongos                                                x86_64                                  7.0.12-1.el9                                   mongodb-org-7.0                                   24 M</span><br><span class="line"> mongodb-org-server                                                x86_64                                  7.0.12-1.el9                                   mongodb-org-7.0                                   35 M</span><br><span class="line"> mongodb-org-tools                                                 x86_64                                  7.0.12-1.el9                                   mongodb-org-7.0                                  9.3 k</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">=================================================================================================================================================================================================================</span><br><span class="line">安装  8 软件包</span><br><span class="line"></span><br><span class="line">总下载：143 M</span><br><span class="line">安装大小：642 M</span><br><span class="line">下载软件包：</span><br><span class="line">(1/8): mongodb-org-7.0.12-1.el9.x86_64.rpm                                                                                                                                        15 kB/s | 9.3 kB     00:00</span><br><span class="line">(2/8): mongodb-org-database-7.0.12-1.el9.x86_64.rpm                                                                                                                               12 kB/s | 9.4 kB     00:00</span><br><span class="line">(3/8): mongodb-database-tools-100.9.5-1.x86_64.rpm                                                                                                                                12 MB/s |  28 MB     00:02</span><br><span class="line">(4/8): mongodb-org-database-tools-extra-7.0.12-1.el9.x86_64.rpm                                                                                                                   14 kB/s |  14 kB     00:01</span><br><span class="line">(5/8): mongodb-mongosh-2.2.12.x86_64.rpm                                                                                                                                          14 MB/s |  56 MB     00:03</span><br><span class="line">(6/8): mongodb-org-tools-7.0.12-1.el9.x86_64.rpm                                                                                                                                  21 kB/s | 9.3 kB     00:00</span><br><span class="line">(7/8): mongodb-org-server-7.0.12-1.el9.x86_64.rpm                                                                                                                                 12 MB/s |  35 MB     00:02</span><br><span class="line">(8/8): mongodb-org-mongos-7.0.12-1.el9.x86_64.rpm                                                                                                                                6.6 MB/s |  24 MB     00:03</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">总计                                                                                                                                                                              23 MB/s | 143 MB     00:06</span><br><span class="line">运行事务检查</span><br><span class="line">事务检查成功。</span><br><span class="line">运行事务测试</span><br><span class="line">事务测试成功。</span><br><span class="line">运行事务</span><br><span class="line">  准备中  :                                                                                                                                                                                                  1/1</span><br><span class="line">  安装    : mongodb-org-database-tools-extra-7.0.12-1.el9.x86_64                                                                                                                                             1/8</span><br><span class="line">  运行脚本: mongodb-org-server-7.0.12-1.el9.x86_64                                                                                                                                                           2/8</span><br><span class="line">  安装    : mongodb-org-server-7.0.12-1.el9.x86_64                                                                                                                                                           2/8</span><br><span class="line">  运行脚本: mongodb-org-server-7.0.12-1.el9.x86_64                                                                                                                                                           2/8</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/mongod.service → /usr/lib/systemd/system/mongod.service.</span><br><span class="line"></span><br><span class="line">  安装    : mongodb-org-mongos-7.0.12-1.el9.x86_64                                                                                                                                                           3/8</span><br><span class="line">  安装    : mongodb-org-database-7.0.12-1.el9.x86_64                                                                                                                                                         4/8</span><br><span class="line">  安装    : mongodb-mongosh-2.2.12-1.el8.x86_64                                                                                                                                                              5/8</span><br><span class="line">  运行脚本: mongodb-database-tools-100.9.5-1.x86_64                                                                                                                                                          6/8</span><br><span class="line">  安装    : mongodb-database-tools-100.9.5-1.x86_64                                                                                                                                                          6/8</span><br><span class="line">  运行脚本: mongodb-database-tools-100.9.5-1.x86_64                                                                                                                                                          6/8</span><br><span class="line">  安装    : mongodb-org-tools-7.0.12-1.el9.x86_64                                                                                                                                                            7/8</span><br><span class="line">  安装    : mongodb-org-7.0.12-1.el9.x86_64                                                                                                                                                                  8/8</span><br><span class="line">  运行脚本: mongodb-org-7.0.12-1.el9.x86_64                                                                                                                                                                  8/8</span><br><span class="line">  验证    : mongodb-database-tools-100.9.5-1.x86_64                                                                                                                                                          1/8</span><br><span class="line">  验证    : mongodb-mongosh-2.2.12-1.el8.x86_64                                                                                                                                                              2/8</span><br><span class="line">  验证    : mongodb-org-7.0.12-1.el9.x86_64                                                                                                                                                                  3/8</span><br><span class="line">  验证    : mongodb-org-database-7.0.12-1.el9.x86_64                                                                                                                                                         4/8</span><br><span class="line">  验证    : mongodb-org-database-tools-extra-7.0.12-1.el9.x86_64                                                                                                                                             5/8</span><br><span class="line">  验证    : mongodb-org-mongos-7.0.12-1.el9.x86_64                                                                                                                                                           6/8</span><br><span class="line">  验证    : mongodb-org-server-7.0.12-1.el9.x86_64                                                                                                                                                           7/8</span><br><span class="line">  验证    : mongodb-org-tools-7.0.12-1.el9.x86_64                                                                                                                                                            8/8</span><br><span class="line">已更新安装的产品。</span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  mongodb-database-tools-100.9.5-1.x86_64                       mongodb-mongosh-2.2.12-1.el8.x86_64             mongodb-org-7.0.12-1.el9.x86_64                 mongodb-org-database-7.0.12-1.el9.x86_64</span><br><span class="line">  mongodb-org-database-tools-extra-7.0.12-1.el9.x86_64          mongodb-org-mongos-7.0.12-1.el9.x86_64          mongodb-org-server-7.0.12-1.el9.x86_64          mongodb-org-tools-7.0.12-1.el9.x86_64</span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>
到这里使用yum安装<code>mongodb</code>就完成了</li>
</ol>
<h3 id="1-2-手动下载安装"><a href="#1-2-手动下载安装" class="headerlink" title="1.2  手动下载安装"></a>1.2  手动下载安装</h3><p>不推荐,因为需要补充各种依赖包，手动下载MongoDB的RPM包并使用rpm或<code>yum localinstall</code>命令进行安装。这种方法需要您从MongoDB官网或其他可靠源下载适用于Red Hat 9.4的RPM包。<br>打开MongoDB的<a target="_blank" rel="noopener" href="https://www.mongodb.com/">官方网站</a>，并导航到<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center/community">MongoDB下载页面</a>。通常，可以在首页的导航栏中找到“Download”或“Downloads”链接。</p>
<p>在下载页面上，根据操作系统版本（<code>Red Hat Enterprise Linux 9.x</code> 或兼容的发行版）和架构（<code>x86_64</code>）选择适合的MongoDB RPM包。注意，MongoDB提供了社区版和企业版，这里我们以社区版为例。<br>点击下载按钮开始下载RPM包。下载完成后，将在浏览器指定的下载位置找到该RPM包文件，文件名可能类似于<code>mongodb-org-server-7.0.12-1.el9.x86_64.rpm</code></p>
<h4 id="使用rpm命令安装"><a href="#使用rpm命令安装" class="headerlink" title="使用rpm命令安装"></a>使用rpm命令安装</h4><p>将包放到Linux系统目录中，我这里是放在了<code>/home/ftp</code>目录下,<code>cd</code>命令切换到<code>/home/ftp</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ftp</span><br></pre></td></tr></table></figure>
<p>使用rmp命令安装MongoDB</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> rpm -ivh mongodb-org-server-7.0.12-1.el9.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>这里，<code>-i</code>表示安装，<code>-v</code>表示详细输出，<code>-h</code>表示显示安装进度。</p>
<p>注意：如果安装过程中提示缺少依赖项,可以按照上面yum安装过程中的输出继续下载依赖，进行安装，可能需要先安装这些依赖项，或者考虑使用<code>yum localinstall</code>命令来自动解决依赖问题。</p>
<h4 id="使用yum-localinstall命令安装"><a href="#使用yum-localinstall命令安装" class="headerlink" title="使用yum localinstall命令安装"></a>使用<code>yum localinstall</code>命令安装</h4><p><code>yum localinstall</code>命令实际上是<code>yum</code>的一个别名，用于安装本地RPM包并自动解决依赖关系。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum localinstall mongodb-org-server-7.0.12-1.el9.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p><code>yum</code>会检查RPM包的依赖项，并尝试从配置的仓库中下载并安装缺失的依赖项。</p>
<h3 id="1-3使用Docker安装"><a href="#1-3使用Docker安装" class="headerlink" title="1.3使用Docker安装"></a>1.3使用Docker安装</h3><p>如果系统已经安装了Docker，可以通过Docker来安装MongoDB。这种方式的好处是可以轻松地在容器中运行MongoDB，便于版本控制和隔离。(由于本文主要讲介绍MongoDB，所以这里就不详细介绍Docker的安装和配置了)</p>
<h4 id="拉取MongoDB镜像"><a href="#拉取MongoDB镜像" class="headerlink" title="拉取MongoDB镜像"></a>拉取MongoDB镜像</h4><p>使用docker pull命令拉取MongoDB镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mongo:latest</span><br></pre></td></tr></table></figure>
<p>或者指定版本号拉取特定版本的MongoDB镜像。<br>会有输出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# docker pull mongo:latest</span><br><span class="line">latest: Pulling from library/mongo</span><br><span class="line">7b1a6ab2e44d: Pull complete</span><br><span class="line">90eb44ebc60b: Pull complete</span><br><span class="line">5085b59f2efb: Pull complete</span><br><span class="line">c7499923d022: Pull complete</span><br><span class="line">019496b6c44a: Pull complete</span><br><span class="line">c0df4f407f69: Pull complete</span><br><span class="line">351daa315b6c: Pull complete</span><br><span class="line">a233e6240acc: Pull complete</span><br><span class="line">a3f57d6be64f: Pull complete</span><br><span class="line">dd1b5b345323: Pull complete</span><br><span class="line">Digest: sha256:5be752bc5f2ac4182252d0f15d74df080923aba39700905cb26d9f70f39e9702</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mongo:latest</span><br><span class="line">docker.io/library/mongo:latest</span><br></pre></td></tr></table></figure>
<h2 id="启动MongoDB"><a href="#启动MongoDB" class="headerlink" title="启动MongoDB"></a>启动MongoDB</h2><p>到这里我们基本就是已经安装好Mongodb了，如果只是内部使用就直接启动就好了，MongoDB已经给出了默认配置，只需要启动就可以使用,执行下面命令启动MongoDB并且查看状态，当然只有yum安装的和手动下载安装的才能使用，Docker安装的无法使用下面的命令进行查看，要依赖docker的命令进行查看；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# systemctl start mongod</span><br><span class="line">[root@sea-whales ~]# systemctl status mongod</span><br><span class="line">● mongod.service - MongoDB Database Server</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/mongod.service; enabled; preset: disabled)</span><br><span class="line">     Active: active (running) since Sat 2024-07-13 16:39:42 CST; 18h ago</span><br><span class="line">       Docs: https://docs.mongodb.org/manual</span><br><span class="line">   Main PID: 1102 (mongod)</span><br><span class="line">     Memory: 303.8M</span><br><span class="line">        CPU: 8min 51.519s</span><br><span class="line">     CGroup: /system.slice/mongod.service</span><br><span class="line">             └─1102 /usr/bin/mongod -f /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">7月 13 16:39:42 sea-whales systemd[1]: Started MongoDB Database Server.</span><br><span class="line">7月 13 16:39:59 sea-whales mongod[1102]: &#123;<span class="string">&quot;t&quot;</span>:&#123;<span class="string">&quot;<span class="variable">$date</span>&quot;</span>:<span class="string">&quot;2024-07-13T08:39:59.209Z&quot;</span>&#125;,<span class="string">&quot;s&quot;</span>:<span class="string">&quot;I&quot;</span>,  <span class="string">&quot;c&quot;</span>:<span class="string">&quot;CONTROL&quot;</span>,  <span class="string">&quot;id&quot;</span>:74845&gt;</span><br></pre></td></tr></table></figure>
<h4 id="运行MongoDB容器"><a href="#运行MongoDB容器" class="headerlink" title="运行MongoDB容器"></a>运行MongoDB容器</h4><p>如果是使用docker安装的则使用<code>docker run</code>命令运行MongoDB容器，并指定必要的参数，如端口映射、数据卷等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mongodb-container -d -p 27017:27017 mongo</span><br></pre></td></tr></table></figure>
<p>这里<code>-p 27017:27017</code>表示将容器的27017端口映射到宿主机的27017端口。<br>使用<code>docker ps</code>命令查看正在运行的容器，确认MongoDB容器已启动。<br>使用MongoDB客户端连接到容器中的MongoDB实例。</p>
<h2 id="配置MongoDB"><a href="#配置MongoDB" class="headerlink" title="配置MongoDB"></a>配置MongoDB</h2><p>MongoDB的配置文件通常位于<code>/etc/mongod.conf</code>，可以通过编辑该文件来配置MongoDB的行为。</p>
<h3 id="通用配置"><a href="#通用配置" class="headerlink" title="通用配置"></a>通用配置</h3><ul>
<li><p><strong>systemLog</strong>:</p>
<ul>
<li><strong>destination</strong>: 指定日志输出的目标，如<code>file</code>或<code>syslog</code>。</li>
<li><strong>path</strong>: 日志文件的路径（如果<code>destination</code>是<code>file</code>）。</li>
<li><strong>logAppend</strong>: 是否追加到日志文件，默认为<code>true</code>。</li>
</ul>
</li>
<li><p><strong>storage</strong>:</p>
<ul>
<li><strong>dbPath</strong>: 数据文件的存储路径。</li>
<li><strong>journal</strong>:<ul>
<li><strong>enabled</strong>: 是否启用journaling，用于数据恢复。</li>
</ul>
</li>
<li><strong>engine</strong>: 存储引擎类型，如<code>wiredTiger</code>。</li>
</ul>
</li>
<li><p><strong>net</strong>:</p>
<ul>
<li><strong>port</strong>: MongoDB监听的端口号，默认为27017。</li>
<li><strong>bindIp</strong>: MongoDB绑定的IP地址，默认为<code>127.0.0.1</code>（仅限本地访问）。</li>
</ul>
</li>
<li><p><strong>security</strong>:</p>
<ul>
<li><strong>authorization</strong>: 是否启用访问控制，<code>enabled</code>表示需要认证。</li>
<li><strong>keyFile</strong>: 集群内部身份验证使用的密钥文件路径。</li>
</ul>
</li>
<li><p><strong>replication</strong>:</p>
<ul>
<li><strong>replSetName</strong>: 复制集的名称，用于设置复制集。</li>
</ul>
</li>
<li><p><strong>processManagement</strong>:</p>
<ul>
<li><strong>fork</strong>: 是否以守护进程方式运行MongoDB，对于生产环境推荐设置为<code>true</code>。</li>
<li><strong>pidFilePath</strong>: 进程ID文件的路径。</li>
</ul>
</li>
<li><p><strong>operationProfiling</strong>:</p>
<ul>
<li><strong>mode</strong>: 性能分析的模式，如<code>slowOp</code>（仅记录慢操作）。</li>
<li><strong>slowOpThresholdMs</strong>: 慢操作的阈值（毫秒）。</li>
</ul>
</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>以下是我使用一个简化的<code>/etc/mongod.conf</code>配置文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MongoDB配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统日志配置</span></span><br><span class="line"><span class="attr">systemLog:</span></span><br><span class="line">  <span class="attr">destination:</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">&quot;/var/log/mongodb/mongod.log&quot;</span></span><br><span class="line">  <span class="attr">logAppend:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储引擎配置</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">dbPath:</span> <span class="string">&quot;/var/lib/mongodb&quot;</span></span><br><span class="line">  <span class="attr">journal:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">engine:</span> <span class="string">wiredTiger</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 网络配置</span></span><br><span class="line"><span class="attr">net:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">  <span class="attr">bindIp:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全配置</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">authorization:</span> <span class="string">&quot;enabled&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制集配置（如果适用）</span></span><br><span class="line"><span class="comment"># replication:</span></span><br><span class="line"><span class="comment">#   replSetName: &quot;myReplSet&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程管理配置</span></span><br><span class="line"><span class="attr">processManagement:</span></span><br><span class="line">  <span class="attr">fork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">pidFilePath:</span> <span class="string">&quot;/var/run/mongodb/mongod.pid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能分析配置（可选）</span></span><br><span class="line"><span class="comment"># operationProfiling:</span></span><br><span class="line"><span class="comment">#   mode: slowOp</span></span><br><span class="line"><span class="comment">#   slowOpThresholdMs: 100</span></span><br></pre></td></tr></table></figure>

<p>注意，应该根据自己的需求和MongoDB的版本来调整这些配置。要查看所有可用的配置项及其当前值，可以直接查看<code>/etc/mongod.conf</code>文件，或者使用MongoDB的<code>--config</code>选项与<code>mongod</code>命令结合来指定一个配置文件，并通过<code>--verbose</code>选项获取更多输出信息。<br>但是，请注意，<code>--verbose</code>选项通常用于命令行启动MongoDB时增加日志输出的详细程度，而不是直接列出配置文件中的所有配置项。要列出所有配置项及其默认值，可能需要查阅MongoDB的官方文档。</p>
<p>配置好之后需要执行下面的命令使得配置生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# <span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line">[root@sea-whales ~]# <span class="built_in">sudo</span> systemctl restart mongod</span><br></pre></td></tr></table></figure>
<p>如果修改后不执行<code>daemon-reload</code>就直接执行<code>restart</code>命令，可能有一个警告，提示你要你先执行<code>daemon-reload</code>，然后再执行<code>restart</code>命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# sudo systemctl restart mongod</span><br><span class="line">Warning: The unit file, source configuration file or drop-ins of mongod.service changed on disk. Run &#x27;systemctl daemon-reload&#x27; to reload units.</span><br></pre></td></tr></table></figure>
<h3 id="Docker安装后配置MongoDB"><a href="#Docker安装后配置MongoDB" class="headerlink" title="Docker安装后配置MongoDB"></a>Docker安装后配置MongoDB</h3><p>docker安装mongodb后，需要修改配置文件的话需要进行一些操作，一般有两种方法：</p>
<h4 id="方法一：直接编辑容器内的配置文件"><a href="#方法一：直接编辑容器内的配置文件" class="headerlink" title="方法一：直接编辑容器内的配置文件"></a>方法一：直接编辑容器内的配置文件</h4><ol>
<li><p><strong>定位配置文件</strong>：<br>MongoDB的配置文件通常位于容器内的<code>/etc/mongod.conf</code>路径下。</p>
</li>
<li><p><strong>复制配置文件到本地</strong>：<br>使用<code>docker cp</code>命令将容器中的配置文件复制到本地，以便进行修改。命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> &lt;容器ID或名称&gt;:/etc/mongod.conf /path/to/local/mongod.conf</span><br></pre></td></tr></table></figure>
<p>这里<code>&lt;容器ID或名称&gt;</code>是MongoDB容器的ID或名称，<code>/path/to/local/mongod.conf</code>是本地文件系统的目标路径。</p>
</li>
<li><p><strong>修改配置文件</strong>：<br>使用文本编辑器（如Vim、Nano、Sublime Text等）打开复制到本地的<code>mongod.conf</code>文件，并修改需要的配置项。常见的配置项包括端口号、数据存储路径、日志级别等。</p>
</li>
<li><p><strong>将修改后的配置文件复制回容器</strong>：<br>使用<code>docker cp</code>命令将修改后的配置文件复制回容器中的原始位置。命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> /path/to/local/mongod.conf &lt;容器ID或名称&gt;:/etc/mongod.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重启MongoDB容器</strong>：<br>使用<code>docker restart</code>命令重启MongoDB容器，使修改生效。命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart &lt;容器ID或名称&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="方法二：使用Docker卷（Volume）映射配置文件"><a href="#方法二：使用Docker卷（Volume）映射配置文件" class="headerlink" title="方法二：使用Docker卷（Volume）映射配置文件"></a>方法二：使用Docker卷（Volume）映射配置文件</h4><p>这种方法不需要进入容器内部，而是通过Docker卷将宿主机上的目录映射到容器内的配置文件目录。</p>
<ol>
<li><p><strong>在宿主机上创建配置文件</strong>：<br>在宿主机上创建一个目录，用于存放MongoDB的配置文件。例如，创建<code>/path/to/mongodb/config</code>目录，并将MongoDB的配置文件（如<code>mongod.conf</code>）放入该目录中。</p>
</li>
<li><p><strong>启动MongoDB容器时使用卷映射</strong>：<br>在启动MongoDB容器时，使用<code>-v</code>或<code>--volume</code>参数将宿主机上的配置文件目录映射到容器内的配置文件目录。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mongodb -p 27017:27017 -v /path/to/mongodb/config:/etc/mongod.conf mongo:latest</span><br></pre></td></tr></table></figure>
<p>注意：这里的映射路径可能需要根据实际情况进行调整，因为MongoDB的配置文件通常位于<code>/etc/mongod.conf</code>，但上述命令中的映射可能会覆盖整个<code>/etc/mongod.conf</code>文件而不是目录。实际上，你可能需要创建一个包含<code>mongod.conf</code>的目录，并将其映射到容器内的相应目录，如<code>/etc/mongodb</code>（这取决于MongoDB容器内部的目录结构）。正确的命令可能类似于：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mongodb -p 27017:27017 -v /path/to/mongodb/config:/etc/mongodb mongo:latest</span><br></pre></td></tr></table></figure>
<p>并确保宿主机上的<code>/path/to/mongodb/config</code>目录中包含<code>mongod.conf</code>文件。</p>
</li>
<li><p><strong>重启MongoDB容器</strong>（如果容器已经运行）：<br>如果MongoDB容器已经在运行，并且你想要应用新的配置文件，你需要先停止容器，删除旧的容器（可选，但推荐以避免配置冲突），然后使用新的配置文件重新创建并启动容器。</p>
</li>
</ol>
<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><ul>
<li>在修改配置文件之前，建议备份原始配置文件，以防万一需要恢复。</li>
<li>确保修改后的配置文件语法正确，并且符合MongoDB的要求。</li>
<li>如果使用Docker卷映射配置文件，请确保宿主机上的配置文件路径和容器内的映射路径正确无误。</li>
<li>MongoDB的配置项非常多，具体可配置的选项请参考MongoDB的官方文档。</li>
</ul>
<h2 id="访问MongoDB"><a href="#访问MongoDB" class="headerlink" title="访问MongoDB"></a>访问MongoDB</h2><p>访问基本以及使用这边就不多描述了，基本的操作就是通过mongo命令行工具来操作数据库了，具体操作可以参考官方文档。</p>
<h2 id="2-MongoDB错误解决"><a href="#2-MongoDB错误解决" class="headerlink" title="2. MongoDB错误解决"></a>2. MongoDB错误解决</h2><h3 id="错误1：MongoDB启动失败"><a href="#错误1：MongoDB启动失败" class="headerlink" title="错误1：MongoDB启动失败"></a>错误1：MongoDB启动失败</h3><p>错误原因：MongoDB启动失败，可能是端口被占用，也可能是MongoDB的配置文件错误。<br>解决方法：</p>
<ol>
<li>检查端口是否被占用<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:27017</span><br></pre></td></tr></table></figure></li>
<li>修改MongoDB的配置文件<br>修改MongoDB的配置文件，将端口号改为其他端口号，例如：27018</li>
<li>重启MongoDB</li>
</ol>
<h3 id="错误2："><a href="#错误2：" class="headerlink" title="错误2："></a>错误2：</h3><p>我遇到一个错误就是在修改MongoDB的配置文件的<code>bindIp</code>项目为<code>0.0.0.0</code>后，重启MongoDB的时候出现了如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# <span class="built_in">sudo</span> systemctl status mongod</span><br><span class="line">× mongod.service - MongoDB Database Server</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/mongod.service; enabled; preset: disabled)</span><br><span class="line">     Active: failed (Result: exit-code) since Sun 2024-07-14 11:24:58 CST; 3s ago</span><br><span class="line">   Duration: 79ms</span><br><span class="line">       Docs: https://docs.mongodb.org/manual</span><br><span class="line">    Process: 59341 ExecStart=/usr/bin/mongod <span class="variable">$OPTIONS</span> (code=exited, status=14)</span><br><span class="line">   Main PID: 59341 (code=exited, status=14)</span><br><span class="line">        CPU: 65ms</span><br><span class="line"></span><br><span class="line">7月 14 11:24:58 sea-whales systemd[1]: Started MongoDB Database Server.</span><br><span class="line">7月 14 11:24:58 sea-whales systemd[1]: mongod.service: Main process exited, code=exited, status=14/n/a</span><br><span class="line">7月 14 11:24:58 sea-whales systemd[1]: mongod.service: Failed with result <span class="string">&#x27;exit-code&#x27;</span>.</span><br></pre></td></tr></table></figure>
<p>然后就算我修改回<code>127.0.0.1</code>后也是是报告一样的错误；<br>通过查询以下是AI给出的分析：</p>
<blockquote>
<p>从您提供的日志信息来看，MongoDB 服务在启动时遇到了问题，并且以状态码 14 退出。状态码 14 通常不是一个标准的 MongoDB 退出码，但在某些情况下，它可能与系统级的问题或 MongoDB 试图执行某些不被允许的操作有关。这里有几个可能的解决步骤和检查点：</p>
<ol>
<li><strong>检查 MongoDB 配置文件</strong>：</li>
</ol>
<ul>
<li>确保 MongoDB 的配置文件（如 <code>/etc/mongod.conf</code> 或指定的配置文件路径）没有错误。</li>
<li>检查配置文件中的路径设置（如 <code>dbPath</code> 和 <code>logPath</code>）是否正确，且 MongoDB 进程有权限访问这些路径。</li>
</ul>
<ol start="2">
<li><strong>查看 MongoDB 日志文件</strong>：</li>
</ol>
<ul>
<li>MongoDB 的日志文件通常会提供更多关于为什么服务无法启动的详细信息。检查 <code>/var/log/mongodb/mongod.log</code> 或您配置文件中指定的日志路径。</li>
</ul>
<ol start="3">
<li><strong>检查系统资源</strong>：</li>
</ol>
<ul>
<li>确保系统有足够的磁盘空间、内存和 CPU 资源来运行 MongoDB。</li>
<li>检查是否有其他服务或进程占用了 MongoDB 所需的端口（默认是 27017）。</li>
</ul>
<ol start="4">
<li><strong>检查 SELinux 或 AppArmor 设置</strong>：</li>
</ol>
<ul>
<li>如果您的系统启用了 SELinux 或 AppArmor，它们可能会阻止 MongoDB 正常启动。检查相关的安全策略或暂时禁用它们以测试是否是安全设置导致的问题。</li>
</ul>
<ol start="5">
<li><strong>检查 MongoDB 权限</strong>：</li>
</ol>
<ul>
<li>确保 MongoDB 的可执行文件（如 <code>/usr/bin/mongod</code>）和数据库文件目录的权限设置正确。</li>
<li>MongoDB 通常需要 root 权限来绑定到低端口（如 27017），但建议通过 systemd 或其他服务管理工具以非 root 用户身份运行。</li>
</ul>
<ol start="6">
<li><strong>检查 systemd 单元文件</strong>：</li>
</ol>
<ul>
<li>查看 <code>/usr/lib/systemd/system/mongod.service</code> 文件中的 <code>ExecStart</code> 行，确保 <code>$OPTIONS</code> 变量正确设置，并且没有语法错误。</li>
<li>尝试手动运行 MongoDB 服务命令（如 <code>/usr/bin/mongod --config /etc/mongod.conf</code>）来检查是否可以直接从命令行启动。</li>
</ul>
<ol start="7">
<li><strong>重新启动 MongoDB 服务</strong>：</li>
</ol>
<ul>
<li>在进行任何更改后，尝试重新启动 MongoDB 服务：<code>sudo systemctl restart mongod.service</code>。</li>
</ul>
<ol start="8">
<li><strong>查看系统日志</strong>：</li>
</ol>
<ul>
<li>检查 <code>/var/log/syslog</code> 或其他系统日志文件，看是否有与 MongoDB 相关的更详细的错误消息。<br>如果上述步骤都不能解决问题，您可能需要考虑重新安装 MongoDB 或寻求更具体的帮助，例如在 MongoDB 社区论坛或支持渠道中询问。</li>
</ul>
</blockquote>
<p>于是我尝试使用<code>/usr/bin/mongod -f /etc/mongod.conf</code>启动，然后在另一个终端执行<code>tail -f /var/log/mongodb/mongod.log</code>命令进行日志的实时查看，也没发现任何报错信息。</p>
<p>通过各种尝试，最后居然是因为<code>MongoDB</code>数据目录的权限和所有权正确,只需要执行下面两句命令后，在进行重启就可以正常启动了;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# <span class="built_in">sudo</span> <span class="built_in">chown</span> -R mongod:mongod /var/lib/mongo</span><br><span class="line">[root@sea-whales ~]# <span class="built_in">sudo</span> <span class="built_in">chmod</span> -R 755 /var/lib/mongo</span><br><span class="line">[root@sea-whales ~]# systemctl status mongod</span><br><span class="line">● mongod.service - MongoDB Database Server</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/mongod.service; enabled; preset: disabled)</span><br><span class="line">     Active: active (running) since Sun 2024-07-14 13:02:36 CST; 4s ago</span><br><span class="line">       Docs: https://docs.mongodb.org/manual</span><br><span class="line">   Main PID: 61154 (mongod)</span><br><span class="line">     Memory: 176.5M</span><br><span class="line">        CPU: 1.582s</span><br><span class="line">     CGroup: /system.slice/mongod.service</span><br><span class="line">             └─61154 /usr/bin/mongod -f /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">7月 14 13:02:36 sea-whales systemd[1]: Started MongoDB Database Server.</span><br></pre></td></tr></table></figure>
<p>这个问题是我没想到的，因为在前面安装之后MongoDB是可以正常启动的，但是后来我修改了MongoDB的配置文件，然后重启了MongoDB，就出现了这个错误,都没想到会是因为权限的问题。</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>经过一些回想，我想到了原来在安装的时候MongoDB我是使用root进行安装的，所以权限是默认的，但是后来<br>我在做服务的时候默认将mongod服务以mongod用户和组的权限运行，就是下面配置文件中 <code>[Service] </code>中的<code>User</code>和<code>Group</code>配置项，导致权限问题，所以导致无法启动服务；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@sea-whales ~]# <span class="built_in">cat</span> /usr/lib/systemd/system/mongod.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MongoDB Database Server</span><br><span class="line">Documentation=https://docs.mongodb.org/manual</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mongod</span><br><span class="line">Group=mongod</span><br><span class="line">Environment=<span class="string">&quot;OPTIONS=-f /etc/mongod.conf&quot;</span></span><br><span class="line"><span class="comment"># Environment=&quot;MONGODB_CONFIG_OVERRIDE_NOFORK=1&quot;</span></span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mongod</span><br><span class="line">ExecStart=/usr/bin/mongod -f <span class="variable">$OPTIONS</span></span><br><span class="line"><span class="comment"># $OPTIONS</span></span><br><span class="line">RuntimeDirectory=mongodb</span><br><span class="line"><span class="comment"># file size</span></span><br><span class="line">LimitFSIZE=infinity</span><br><span class="line"><span class="comment"># cpu time</span></span><br><span class="line">LimitCPU=infinity</span><br><span class="line"><span class="comment"># virtual memory size</span></span><br><span class="line">LimitAS=infinity</span><br><span class="line"><span class="comment"># open files</span></span><br><span class="line">LimitNOFILE=64000</span><br><span class="line"><span class="comment"># processes/threads</span></span><br><span class="line">LimitNPROC=64000</span><br><span class="line"><span class="comment"># locked memory</span></span><br><span class="line">LimitMEMLOCK=infinity</span><br><span class="line"><span class="comment"># total threads (user+kernel)</span></span><br><span class="line">TasksMax=infinity</span><br><span class="line">TasksAccounting=<span class="literal">false</span></span><br><span class="line"><span class="comment"># Recommended limits for mongod as specified in</span></span><br><span class="line"><span class="comment"># https://docs.mongodb.com/manual/reference/ulimit/#recommended-ulimit-settings</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">[root@sea-whales ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

        </div>
    

</div>
            
        </section>
    </div>
</div>






</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a target="_blank" rel="noopener" href="https://github.com/sea-whales">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/posts/192071107/">关键路径法简介</a>
            </li>
            
            <li>
                <a class="footer-post" href="/posts/3061785244/">Kivy笔记</a>
            </li>
            
            <li>
                <a class="footer-post" href="/posts/1604330648/">Linux多线程下载</a>
            </li>
            
            <li>
                <a class="footer-post" href="/posts/742726656/">字符串匹配的KMP算法</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/sea-whales">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:956590645@qq.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>